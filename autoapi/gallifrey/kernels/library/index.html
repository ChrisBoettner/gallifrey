
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ChrisBoettner.github.io/gallifrey/autoapi/gallifrey/kernels/library/">
      
      
        <link rel="prev" href="../atoms/">
      
      
        <link rel="next" href="../prior/">
      
      
      <link rel="icon" href="../../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>library - gallifrey Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gallifrey.kernels.library" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="gallifrey Documentation" class="md-header__button md-logo" aria-label="gallifrey Documentation" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            gallifrey Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              library
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="lime"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ChrisBoettner/gallifrey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="gallifrey Documentation" class="md-nav__button md-logo" aria-label="gallifrey Documentation" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    gallifrey Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ChrisBoettner/gallifrey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../stellar_variability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time series interpolation and forecasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transit fitting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../comparison_with_simple_kernel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comparison with simple kernel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transmission_spectrum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transmission spectrum of HATS-46 b
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    gallifrey
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            gallifrey
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gpconfig/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gpconfig
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_3" >
        
          
          <label class="md-nav__link" for="__nav_4_1_3" id="__nav_4_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    inference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            inference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/hmc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    hmc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/parameter_rejuvenation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameter_rejuvenation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/rejuvenation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rejuvenation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/smc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    smc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    state
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/transforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    transforms
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    kernels
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1_4">
            <span class="md-nav__icon md-icon"></span>
            kernels
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../atoms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    atoms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    library
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    library
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gallifrey.kernels.library" class="md-nav__link">
    <span class="md-ellipsis">
      library
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary" class="md-nav__link">
    <span class="md-ellipsis">
      KernelLibrary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KernelLibrary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.get_support_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      get_support_mapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prior
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tree
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_6" >
        
          
          <label class="md-nav__link" for="__nav_4_1_6" id="__nav_4_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    moves
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_6">
            <span class="md-nav__icon md-icon"></span>
            moves
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/acceptance_probability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    acceptance_probability
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/detach_attach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    detach_attach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/noise_proposal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    noise_proposal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/particle_move/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    particle_move
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/subtree_replace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    subtree_replace
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parameter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../particles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    particles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    schedule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_10" >
        
          
          <label class="md-nav__link" for="__nav_4_1_10" id="__nav_4_1_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_10">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/probability_calculations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    probability_calculations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/tree_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tree_helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/typing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    typing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gallifrey.kernels.library" class="md-nav__link">
    <span class="md-ellipsis">
      library
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary" class="md-nav__link">
    <span class="md-ellipsis">
      KernelLibrary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KernelLibrary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.kernels.library.KernelLibrary.get_support_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      get_support_mapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>library</h1>

<div class="doc doc-object doc-module">



<a id="gallifrey.kernels.library"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="gallifrey.kernels.library.KernelLibrary" class="doc doc-heading">
            <code>KernelLibrary</code>


</h2>


    <div class="doc doc-contents ">


        <p>A class to store the kernel library, which contains information
about what atoms and operators are available for constructing
the tree kernel.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.atoms">atoms</span></code></td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="list">list</span>[<a class="autorefs autorefs-internal" title="AbstractAtom (gallifrey.kernels.atoms.AbstractAtom)" href="../atoms/#gallifrey.kernels.atoms.AbstractAtom">AbstractAtom</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of atoms that are used to construct the tree kernel.
If None, the default atoms are used. Atoms should inherit
from the AbstractAtom class in gallifrey.kernels.atoms.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.operators">operators</span></code></td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="list">list</span>[<a class="autorefs autorefs-internal" title="AbstractOperator (gallifrey.kernels.atoms.AbstractOperator)" href="../atoms/#gallifrey.kernels.atoms.AbstractOperator">AbstractOperator</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of operators that are used to combine the atoms in the
tree kernel. If None, the default operators are used. Operators
should inherit from the AbstractOperator class in
gallifrey.kernels.atoms.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.num_atoms">num_atoms</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of atoms in the library.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.num_operators">num_operators</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of operators in the library.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.library">library</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="beartype.typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="AbstractAtom (gallifrey.kernels.atoms.AbstractAtom)" href="../atoms/#gallifrey.kernels.atoms.AbstractAtom">AbstractAtom</a>, <a class="autorefs autorefs-internal" title="AbstractOperator (gallifrey.kernels.atoms.AbstractOperator)" href="../atoms/#gallifrey.kernels.atoms.AbstractOperator">AbstractOperator</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list combining the atoms and operators in the library.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.is_operator">is_operator</span></code></td>
            <td>
                  <code><span title="jax.numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A boolean array to indicate if an entry in the library is an operator
or not.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.max_atom_parameters">max_atom_parameters</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of parameters any atom or operator in the library
takes as input.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.prior_transforms">prior_transforms</span></code></td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="tensorflow_probability.substrates.jax.bijectors.Bijector">Bijector</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary that maps the parameter tags to the corresponding
transform functions. Transformation functions must transform
parameter from a standard normal distribution to the desired
(prior) distribution, and should be implemented via
tensorflow_probability bijectors. The default transformations
are used if None. The default transformations are:
- "positive": Log-normal transformation(mu=0.0, sigma=1.0)
- "real": Log-normal transformation(mu=0.0, sigma=1.0)
- "sigmoid": Logit-normal transform(scale=1.0, mu=0.0, sigma=1.0)
NOTE: To make functions that use this dict jittable, the prior_transforms
is converted to a FrozenDict, to make it hashable.
NOTE: The "none" key is reserved for internal use and should not be
used in the prior_transforms dictionary.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.support_tag_mapping">support_tag_mapping</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary that maps the support tags to integer values.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.support_mapping_array">support_mapping_array</span></code></td>
            <td>
                  <code><span title="jax.numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array that contains the support tags as integers for each parameter
in the library.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.kernels.library.KernelLibrary.support_transforms">support_transforms</span></code></td>
            <td>
                  <code><span title="flax.core.FrozenDict">FrozenDict</span>[<span title="str">str</span>, <span title="Transformation">Transformation</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A (frozen) dict that maps the parameter tags to the corresponding transform
functions. Transformation functions must transform parameter from a constrained
space to an unconstrained space. This is used for sampling and optimization.
NOTE: This should ideally never be touched, unless you know what you are doing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>gallifrey/kernels/library.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">KernelLibrary</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to store the kernel library, which contains information</span>
<span class="sd">    about what atoms and operators are available for constructing</span>
<span class="sd">    the tree kernel.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    atoms : tp.Optional[list[AbstractAtom]]</span>
<span class="sd">        A list of atoms that are used to construct the tree kernel.</span>
<span class="sd">        If None, the default atoms are used. Atoms should inherit</span>
<span class="sd">        from the AbstractAtom class in gallifrey.kernels.atoms.</span>
<span class="sd">    operators : tp.Optional[list[AbstractOperator]]</span>
<span class="sd">        A list of operators that are used to combine the atoms in the</span>
<span class="sd">        tree kernel. If None, the default operators are used. Operators</span>
<span class="sd">        should inherit from the AbstractOperator class in</span>
<span class="sd">        gallifrey.kernels.atoms.</span>
<span class="sd">    num_atoms : int</span>
<span class="sd">        The number of atoms in the library.</span>
<span class="sd">    num_operators : int</span>
<span class="sd">        The number of operators in the library.</span>
<span class="sd">    library : list[tp.Union[AbstractAtom, AbstractOperator]]</span>
<span class="sd">        A list combining the atoms and operators in the library.</span>
<span class="sd">    is_operator : jnp.ndarray</span>
<span class="sd">        A boolean array to indicate if an entry in the library is an operator</span>
<span class="sd">        or not.</span>
<span class="sd">    max_atom_parameters : int</span>
<span class="sd">        The maximum number of parameters any atom or operator in the library</span>
<span class="sd">        takes as input.</span>
<span class="sd">    prior_transforms : tp.Optional[dict[str, tfb.Bijector]]</span>
<span class="sd">        A dictionary that maps the parameter tags to the corresponding</span>
<span class="sd">        transform functions. Transformation functions must transform</span>
<span class="sd">        parameter from a standard normal distribution to the desired</span>
<span class="sd">        (prior) distribution, and should be implemented via</span>
<span class="sd">        tensorflow_probability bijectors. The default transformations</span>
<span class="sd">        are used if None. The default transformations are:</span>
<span class="sd">        - &quot;positive&quot;: Log-normal transformation(mu=0.0, sigma=1.0)</span>
<span class="sd">        - &quot;real&quot;: Log-normal transformation(mu=0.0, sigma=1.0)</span>
<span class="sd">        - &quot;sigmoid&quot;: Logit-normal transform(scale=1.0, mu=0.0, sigma=1.0)</span>
<span class="sd">        NOTE: To make functions that use this dict jittable, the prior_transforms</span>
<span class="sd">        is converted to a FrozenDict, to make it hashable.</span>
<span class="sd">        NOTE: The &quot;none&quot; key is reserved for internal use and should not be</span>
<span class="sd">        used in the prior_transforms dictionary.</span>
<span class="sd">    support_tag_mapping : dict[str, int]</span>
<span class="sd">        A dictionary that maps the support tags to integer values.</span>
<span class="sd">    support_mapping_array : jnp.ndarray</span>
<span class="sd">        An array that contains the support tags as integers for each parameter</span>
<span class="sd">        in the library.</span>
<span class="sd">    support_transforms : FrozenDict[str, Transformation]</span>
<span class="sd">        A (frozen) dict that maps the parameter tags to the corresponding transform</span>
<span class="sd">        functions. Transformation functions must transform parameter from a constrained</span>
<span class="sd">        space to an unconstrained space. This is used for sampling and optimization.</span>
<span class="sd">        NOTE: This should ideally never be touched, unless you know what you are doing.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">atoms</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AbstractAtom</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">operators</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AbstractOperator</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prior_transforms</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Bijector</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the KernelLibrary. If no atoms or operators are provided,</span>
<span class="sd">        a default library is used.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atoms : tp.Optional[list[AbstractAtom]], optional</span>
<span class="sd">            A list of atoms that are used to construct the tree kernel.</span>
<span class="sd">            If None, the default atoms are used. Atoms should inherit</span>
<span class="sd">            from the AbstractAtom class in gallifrey.kernels.atoms, by default None.</span>
<span class="sd">        operators : tp.Optional[list[AbstractOperator]], optional</span>
<span class="sd">            A list of operators that are used to combine the atoms in the</span>
<span class="sd">            tree kernel. If None, the default operators are used. Operators</span>
<span class="sd">            should inherit from the AbstractOperator class in</span>
<span class="sd">            gallifrey.kernels.atoms, by default None.</span>
<span class="sd">        prior_transforms : tp.Optional[dict[str, Transformation]], optional</span>
<span class="sd">            A dictionary that maps the parameter tags to the corresponding transform</span>
<span class="sd">            functions. Transformation functions must transform parameter from a standard</span>
<span class="sd">            normal distribution to the desired (prior) distribution, and should be</span>
<span class="sd">            implemented via tensorflow_probability bijectors.</span>
<span class="sd">            The default transformations are used if None, by default None. The default</span>
<span class="sd">            transformations are:</span>
<span class="sd">            - &quot;positive&quot;: Log-normal transformation(mu=0.0, sigma=1.0)</span>
<span class="sd">            - &quot;real&quot;: Log-normal transformation(mu=0.0, sigma=1.0)</span>
<span class="sd">            - &quot;sigmoid&quot;: Logit-normal transform(scale=1.0, mu=0.0, sigma=1.0)</span>
<span class="sd">            NOTE: To make &#39;transformation&#39; function (see gallifrey.kernels.prior)</span>
<span class="sd">            jitable, the prior_transforms must be hashable. This is why we use</span>
<span class="sd">            FrozenDict instead of dict.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AbstractAtom</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">atoms</span>
            <span class="k">if</span> <span class="n">atoms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">[</span>
                <span class="n">LinearAtom</span><span class="p">(),</span>
                <span class="n">PeriodicAtom</span><span class="p">(),</span>
                <span class="n">RBFAtom</span><span class="p">(),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AbstractOperator</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">operators</span>
            <span class="k">if</span> <span class="n">operators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">[</span>
                <span class="n">SumOperator</span><span class="p">(),</span>
                <span class="n">ProductOperator</span><span class="p">(),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_operators</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">)</span>

        <span class="c1"># construct the library by combining the atoms and operators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">library</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span>

        <span class="c1"># create boolean array to indicate if entry is operator or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_operator</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># get the maximum number of parameters any atom or operator takes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_atom_parameters</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">num_parameter</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>

        <span class="c1"># transformation functions from normal distribution to prior distribution</span>
        <span class="c1"># NOTE: names are inherited from GPJax, but we don&#39;t use the same</span>
        <span class="c1"># transformations (which is why sigmoid is the name for the logit-normal)</span>
        <span class="k">if</span> <span class="n">prior_transforms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior_transforms</span><span class="p">:</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Bijector</span><span class="p">]</span> <span class="o">=</span> <span class="n">FrozenDict</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="c1"># this is the transformation y = exp(mu + sigma * z),</span>
                    <span class="c1"># with mu = 0 and sigma = 1,</span>
                    <span class="c1"># if z ~ normal(0, 1) then y ~ log-normal(mu, sigma)</span>
                    <span class="s2">&quot;real&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">tfb</span><span class="o">.</span><span class="n">Exp</span><span class="p">(),</span>
                            <span class="n">tfb</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                            <span class="n">tfb</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)),</span>
                        <span class="p">]</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">tfb</span><span class="o">.</span><span class="n">Exp</span><span class="p">(),</span>
                            <span class="n">tfb</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                            <span class="n">tfb</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)),</span>
                        <span class="p">]</span>
                    <span class="p">),</span>
                    <span class="c1"># this is the transformation y = 1/(1 + exp(-(mu + sigma * z))),</span>
                    <span class="c1"># with mu = 0 and sigma = 1,</span>
                    <span class="c1"># if z ~ normal(0, 1) then y ~ logit-normal(mu, sigma)</span>
                    <span class="s2">&quot;sigmoid&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">tfb</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span>
                                <span class="n">low</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
                                <span class="n">high</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.95</span><span class="p">),</span>  <span class="c1"># to avoid numerical issues</span>
                            <span class="p">),</span>
                            <span class="n">tfb</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                            <span class="n">tfb</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                        <span class="p">]</span>
                    <span class="p">),</span>
                    <span class="c1"># identity transformation for parameter that do not fall under</span>
                    <span class="c1"># the above categories</span>
                    <span class="s2">&quot;none&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Identity</span><span class="p">(),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;none&quot;</span> <span class="ow">in</span> <span class="n">prior_transforms</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;&#39;prior_transforms&#39; should not contain the key &#39;none&#39;, &quot;</span>
                    <span class="s2">&quot;as it is reserved for internal use.&quot;</span>
                <span class="p">)</span>
            <span class="n">prior_transforms</span><span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior_transforms</span> <span class="o">=</span> <span class="n">FrozenDict</span><span class="p">(</span><span class="n">prior_transforms</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">support_mapping_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">support_tag_mapping</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_support_mapping</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># besides the prior transforms, we also perform transforms</span>
        <span class="c1"># between a constrained and unconstrained space for fitting/sampling,</span>
        <span class="c1"># this probably should never be touched unless you implement a new</span>
        <span class="c1"># kernel with new constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support_transforms</span><span class="p">:</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Bijector</span><span class="p">]</span> <span class="o">=</span> <span class="n">FrozenDict</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Softplus</span><span class="p">(),</span>
                <span class="s2">&quot;real&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Identity</span><span class="p">(),</span>
                <span class="s2">&quot;sigmoid&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.95</span><span class="p">),</span>
                <span class="s2">&quot;lower_triangular&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">FillTriangular</span><span class="p">(),</span>
                <span class="s2">&quot;none&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Identity</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_tags</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the (technical) string representation of the KernelLibrary.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The (technical) string representation of the KernelLibrary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;KernelLibrary(</span><span class="se">\n</span><span class="s2">  Atoms=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">   &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;operators=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="si">}</span><span class="se">\n</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the (simplified) string representation of the KernelLibrary.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The (simplified) string representation of the KernelLibrary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">atom_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">tp</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">atom_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">operator_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">tp</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">operator</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">operator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">operator_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;KernelLibrary(</span><span class="se">\n</span><span class="s2">  Atoms=</span><span class="si">{</span><span class="n">atom_names</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">   &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;operators=</span><span class="si">{</span><span class="n">operator_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of items in the library.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of items in the library.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_support_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a mapping between support tags and the integer values, then</span>
<span class="sd">        create an array that contains the support tags for each parameter</span>
<span class="sd">        in the library.</span>
<span class="sd">        (Used for jittable sampling and parameter transformations)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        support_mapping_array : jnp.ndarray</span>
<span class="sd">            An array that contains the support tags for each parameter</span>
<span class="sd">            in the library, with shape (len(self), self.max_atom_parameters),</span>
<span class="sd">            enocded as integers.</span>
<span class="sd">        support_tag_mapping : dict[str, int]</span>
<span class="sd">            A dictionary that maps the support tags to the corresponding</span>
<span class="sd">            integer values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create dict that maps string tags to integer values</span>
        <span class="n">support_tag_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">support_tag</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">support_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_transforms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="n">support_tag_mapping</span><span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># create array that contains the support tag integers for each parameter</span>
        <span class="c1"># in the library</span>
        <span class="n">support_mapping_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_atom_parameters</span><span class="p">),</span> <span class="n">support_tag_mapping</span><span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">num_parameter</span><span class="p">):</span>
                <span class="n">support_mapping_array</span> <span class="o">=</span> <span class="n">support_mapping_array</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                    <span class="n">support_tag_mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">parameter_support</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">support_mapping_array</span><span class="p">,</span> <span class="n">support_tag_mapping</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the parameters of the atoms have constraints that are not yet</span>
<span class="sd">        implemented in the library. If so, raise a warning.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameter_support_tags</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">atom</span><span class="o">.</span><span class="n">parameter_support</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">atom_name</span><span class="p">,</span> <span class="n">tags</span> <span class="ow">in</span> <span class="n">parameter_support_tags</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_transforms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Atom </span><span class="si">{</span><span class="n">atom_name</span><span class="si">!r}</span><span class="s2"> has parameter tags that are not &quot;</span>
                    <span class="s2">&quot;in the prior_transforms dictionary. Tag will be ignored. &quot;</span>
                    <span class="s2">&quot;This will lead to problems when performing parameter &quot;</span>
                    <span class="s2">&quot;transformations. Add the missing tags to the prior_transforms&quot;</span>
                    <span class="s2">&quot;by manually passing the prior_transforms dictionary to the &quot;</span>
                    <span class="s2">&quot;KernelLibrary constructor.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">support_transforms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Kernel </span><span class="si">{</span><span class="n">atom_name</span><span class="si">!r}</span><span class="s2"> has parameter tags that are not &quot;</span>
                <span class="s2">&quot;in the support_transforms dictionary. This will lead to problems &quot;</span>
                <span class="s2">&quot;in the sampling/optmization if used for a KernelTree object. &quot;</span>
                <span class="s2">&quot;Add the missing tags to the by manually overriding the &quot;</span>
                <span class="s2">&quot;support_transforms dictionary to the KernelLibrary constructor.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;THIS IS VERY EXPERIMENTAL AND NOT RECOMMENDED.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="gallifrey.kernels.library.KernelLibrary.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">operators</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prior_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the KernelLibrary. If no atoms or operators are provided,
a default library is used.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>atoms</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="list">list</span>[<a class="autorefs autorefs-internal" title="AbstractAtom (gallifrey.kernels.atoms.AbstractAtom)" href="../atoms/#gallifrey.kernels.atoms.AbstractAtom">AbstractAtom</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of atoms that are used to construct the tree kernel.
If None, the default atoms are used. Atoms should inherit
from the AbstractAtom class in gallifrey.kernels.atoms, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operators</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="list">list</span>[<a class="autorefs autorefs-internal" title="AbstractOperator (gallifrey.kernels.atoms.AbstractOperator)" href="../atoms/#gallifrey.kernels.atoms.AbstractOperator">AbstractOperator</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of operators that are used to combine the atoms in the
tree kernel. If None, the default operators are used. Operators
should inherit from the AbstractOperator class in
gallifrey.kernels.atoms, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prior_transforms</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="Transformation">Transformation</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary that maps the parameter tags to the corresponding transform
functions. Transformation functions must transform parameter from a standard
normal distribution to the desired (prior) distribution, and should be
implemented via tensorflow_probability bijectors.
The default transformations are used if None, by default None. The default
transformations are:
- "positive": Log-normal transformation(mu=0.0, sigma=1.0)
- "real": Log-normal transformation(mu=0.0, sigma=1.0)
- "sigmoid": Logit-normal transform(scale=1.0, mu=0.0, sigma=1.0)
NOTE: To make 'transformation' function (see gallifrey.kernels.prior)
jitable, the prior_transforms must be hashable. This is why we use
FrozenDict instead of dict.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/kernels/library.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">atoms</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AbstractAtom</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">operators</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AbstractOperator</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prior_transforms</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Bijector</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the KernelLibrary. If no atoms or operators are provided,</span>
<span class="sd">    a default library is used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atoms : tp.Optional[list[AbstractAtom]], optional</span>
<span class="sd">        A list of atoms that are used to construct the tree kernel.</span>
<span class="sd">        If None, the default atoms are used. Atoms should inherit</span>
<span class="sd">        from the AbstractAtom class in gallifrey.kernels.atoms, by default None.</span>
<span class="sd">    operators : tp.Optional[list[AbstractOperator]], optional</span>
<span class="sd">        A list of operators that are used to combine the atoms in the</span>
<span class="sd">        tree kernel. If None, the default operators are used. Operators</span>
<span class="sd">        should inherit from the AbstractOperator class in</span>
<span class="sd">        gallifrey.kernels.atoms, by default None.</span>
<span class="sd">    prior_transforms : tp.Optional[dict[str, Transformation]], optional</span>
<span class="sd">        A dictionary that maps the parameter tags to the corresponding transform</span>
<span class="sd">        functions. Transformation functions must transform parameter from a standard</span>
<span class="sd">        normal distribution to the desired (prior) distribution, and should be</span>
<span class="sd">        implemented via tensorflow_probability bijectors.</span>
<span class="sd">        The default transformations are used if None, by default None. The default</span>
<span class="sd">        transformations are:</span>
<span class="sd">        - &quot;positive&quot;: Log-normal transformation(mu=0.0, sigma=1.0)</span>
<span class="sd">        - &quot;real&quot;: Log-normal transformation(mu=0.0, sigma=1.0)</span>
<span class="sd">        - &quot;sigmoid&quot;: Logit-normal transform(scale=1.0, mu=0.0, sigma=1.0)</span>
<span class="sd">        NOTE: To make &#39;transformation&#39; function (see gallifrey.kernels.prior)</span>
<span class="sd">        jitable, the prior_transforms must be hashable. This is why we use</span>
<span class="sd">        FrozenDict instead of dict.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AbstractAtom</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">atoms</span>
        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="p">[</span>
            <span class="n">LinearAtom</span><span class="p">(),</span>
            <span class="n">PeriodicAtom</span><span class="p">(),</span>
            <span class="n">RBFAtom</span><span class="p">(),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AbstractOperator</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">operators</span>
        <span class="k">if</span> <span class="n">operators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="p">[</span>
            <span class="n">SumOperator</span><span class="p">(),</span>
            <span class="n">ProductOperator</span><span class="p">(),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_operators</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">)</span>

    <span class="c1"># construct the library by combining the atoms and operators</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">library</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span>

    <span class="c1"># create boolean array to indicate if entry is operator or not</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_operator</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># get the maximum number of parameters any atom or operator takes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_atom_parameters</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">num_parameter</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>

    <span class="c1"># transformation functions from normal distribution to prior distribution</span>
    <span class="c1"># NOTE: names are inherited from GPJax, but we don&#39;t use the same</span>
    <span class="c1"># transformations (which is why sigmoid is the name for the logit-normal)</span>
    <span class="k">if</span> <span class="n">prior_transforms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_transforms</span><span class="p">:</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Bijector</span><span class="p">]</span> <span class="o">=</span> <span class="n">FrozenDict</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="c1"># this is the transformation y = exp(mu + sigma * z),</span>
                <span class="c1"># with mu = 0 and sigma = 1,</span>
                <span class="c1"># if z ~ normal(0, 1) then y ~ log-normal(mu, sigma)</span>
                <span class="s2">&quot;real&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Exp</span><span class="p">(),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)),</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Exp</span><span class="p">(),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)),</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="c1"># this is the transformation y = 1/(1 + exp(-(mu + sigma * z))),</span>
                <span class="c1"># with mu = 0 and sigma = 1,</span>
                <span class="c1"># if z ~ normal(0, 1) then y ~ logit-normal(mu, sigma)</span>
                <span class="s2">&quot;sigmoid&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span>
                            <span class="n">low</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
                            <span class="n">high</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.95</span><span class="p">),</span>  <span class="c1"># to avoid numerical issues</span>
                        <span class="p">),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="c1"># identity transformation for parameter that do not fall under</span>
                <span class="c1"># the above categories</span>
                <span class="s2">&quot;none&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Identity</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;none&quot;</span> <span class="ow">in</span> <span class="n">prior_transforms</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;prior_transforms&#39; should not contain the key &#39;none&#39;, &quot;</span>
                <span class="s2">&quot;as it is reserved for internal use.&quot;</span>
            <span class="p">)</span>
        <span class="n">prior_transforms</span><span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_transforms</span> <span class="o">=</span> <span class="n">FrozenDict</span><span class="p">(</span><span class="n">prior_transforms</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">support_mapping_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">support_tag_mapping</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_support_mapping</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># besides the prior transforms, we also perform transforms</span>
    <span class="c1"># between a constrained and unconstrained space for fitting/sampling,</span>
    <span class="c1"># this probably should never be touched unless you implement a new</span>
    <span class="c1"># kernel with new constraints</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">support_transforms</span><span class="p">:</span> <span class="n">FrozenDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Bijector</span><span class="p">]</span> <span class="o">=</span> <span class="n">FrozenDict</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Softplus</span><span class="p">(),</span>
            <span class="s2">&quot;real&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Identity</span><span class="p">(),</span>
            <span class="s2">&quot;sigmoid&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.95</span><span class="p">),</span>
            <span class="s2">&quot;lower_triangular&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">FillTriangular</span><span class="p">(),</span>
            <span class="s2">&quot;none&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Identity</span><span class="p">(),</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_check_tags</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.kernels.library.KernelLibrary.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the number of items in the library.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of items in the library.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/kernels/library.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the number of items in the library.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        The number of items in the library.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.kernels.library.KernelLibrary.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the (technical) string representation of the KernelLibrary.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The (technical) string representation of the KernelLibrary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/kernels/library.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the (technical) string representation of the KernelLibrary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The (technical) string representation of the KernelLibrary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;KernelLibrary(</span><span class="se">\n</span><span class="s2">  Atoms=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">   &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;operators=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="si">}</span><span class="se">\n</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.kernels.library.KernelLibrary.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the (simplified) string representation of the KernelLibrary.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The (simplified) string representation of the KernelLibrary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/kernels/library.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the (simplified) string representation of the KernelLibrary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The (simplified) string representation of the KernelLibrary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">atom_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">tp</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">atom_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">operator_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">tp</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">operator</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">operator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span>
        <span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">operator_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;KernelLibrary(</span><span class="se">\n</span><span class="s2">  Atoms=</span><span class="si">{</span><span class="n">atom_names</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">   &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;operators=</span><span class="si">{</span><span class="n">operator_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.kernels.library.KernelLibrary.get_support_mapping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_support_mapping</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a mapping between support tags and the integer values, then
create an array that contains the support tags for each parameter
in the library.
(Used for jittable sampling and parameter transformations)</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>support_mapping_array</code></td>            <td>
                  <code><span title="jax.numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array that contains the support tags for each parameter
in the library, with shape (len(self), self.max_atom_parameters),
enocded as integers.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>support_tag_mapping</code></td>            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary that maps the support tags to the corresponding
integer values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/kernels/library.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_support_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a mapping between support tags and the integer values, then</span>
<span class="sd">    create an array that contains the support tags for each parameter</span>
<span class="sd">    in the library.</span>
<span class="sd">    (Used for jittable sampling and parameter transformations)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    support_mapping_array : jnp.ndarray</span>
<span class="sd">        An array that contains the support tags for each parameter</span>
<span class="sd">        in the library, with shape (len(self), self.max_atom_parameters),</span>
<span class="sd">        enocded as integers.</span>
<span class="sd">    support_tag_mapping : dict[str, int]</span>
<span class="sd">        A dictionary that maps the support tags to the corresponding</span>
<span class="sd">        integer values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create dict that maps string tags to integer values</span>
    <span class="n">support_tag_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">support_tag</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">support_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_transforms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="p">}</span>
    <span class="n">support_tag_mapping</span><span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># create array that contains the support tag integers for each parameter</span>
    <span class="c1"># in the library</span>
    <span class="n">support_mapping_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_atom_parameters</span><span class="p">),</span> <span class="n">support_tag_mapping</span><span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">num_parameter</span><span class="p">):</span>
            <span class="n">support_mapping_array</span> <span class="o">=</span> <span class="n">support_mapping_array</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="n">support_tag_mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">parameter_support</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">support_mapping_array</span><span class="p">,</span> <span class="n">support_tag_mapping</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy", "content.code.annotate", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>