
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ChrisBoettner.github.io/gallifrey/autoapi/gallifrey/utils/tree_helper/">
      
      
        <link rel="prev" href="../probability_calculations/">
      
      
        <link rel="next" href="../typing/">
      
      
      <link rel="icon" href="../../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>tree_helper - gallifrey Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gallifrey.utils.tree_helper" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="gallifrey Documentation" class="md-header__button md-logo" aria-label="gallifrey Documentation" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            gallifrey Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              tree_helper
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="lime"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ChrisBoettner/gallifrey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="gallifrey Documentation" class="md-nav__button md-logo" aria-label="gallifrey Documentation" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    gallifrey Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ChrisBoettner/gallifrey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../stellar_variability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time series interpolation and forecasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transit fitting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../comparison_with_simple_kernel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comparison with simple kernel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transmission_spectrum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transmission spectrum of HATS-46 b
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    gallifrey
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            gallifrey
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gpconfig/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gpconfig
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_3" >
        
          
          <label class="md-nav__link" for="__nav_4_1_3" id="__nav_4_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    inference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            inference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/hmc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    hmc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/parameter_rejuvenation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameter_rejuvenation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/rejuvenation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rejuvenation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/smc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    smc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    state
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inference/transforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    transforms
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_4" >
        
          
          <label class="md-nav__link" for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    kernels
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_4">
            <span class="md-nav__icon md-icon"></span>
            kernels
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernels/atoms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    atoms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernels/library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    library
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernels/prior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prior
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernels/tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tree
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_6" >
        
          
          <label class="md-nav__link" for="__nav_4_1_6" id="__nav_4_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    moves
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_6">
            <span class="md-nav__icon md-icon"></span>
            moves
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/acceptance_probability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    acceptance_probability
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/detach_attach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    detach_attach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/noise_proposal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    noise_proposal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/particle_move/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    particle_move
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/subtree_replace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    subtree_replace
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parameter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../particles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    particles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    schedule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_10" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1_10" id="__nav_4_1_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1_10">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../probability_calculations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    probability_calculations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    tree_helper
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    tree_helper
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper" class="md-nav__link">
    <span class="md-ellipsis">
      tree_helper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.calculate_max_depth" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_max_depth
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.calculate_max_leaves" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_max_leaves
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.calculate_max_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_max_nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.calculate_max_stack_size" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_max_stack_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.clear_subtree" class="md-nav__link">
    <span class="md-ellipsis">
      clear_subtree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.generate_random_path" class="md-nav__link">
    <span class="md-ellipsis">
      generate_random_path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_child_idx" class="md-nav__link">
    <span class="md-ellipsis">
      get_child_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_depth" class="md-nav__link">
    <span class="md-ellipsis">
      get_depth
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_leftmost_leaf" class="md-nav__link">
    <span class="md-ellipsis">
      get_leftmost_leaf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_parameter_leaf_idx" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameter_leaf_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_parent_idx" class="md-nav__link">
    <span class="md-ellipsis">
      get_parent_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_subtree" class="md-nav__link">
    <span class="md-ellipsis">
      get_subtree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.pick_random_node" class="md-nav__link">
    <span class="md-ellipsis">
      pick_random_node
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.reconstruct_path" class="md-nav__link">
    <span class="md-ellipsis">
      reconstruct_path
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../typing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    typing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper" class="md-nav__link">
    <span class="md-ellipsis">
      tree_helper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.calculate_max_depth" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_max_depth
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.calculate_max_leaves" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_max_leaves
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.calculate_max_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_max_nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.calculate_max_stack_size" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_max_stack_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.clear_subtree" class="md-nav__link">
    <span class="md-ellipsis">
      clear_subtree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.generate_random_path" class="md-nav__link">
    <span class="md-ellipsis">
      generate_random_path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_child_idx" class="md-nav__link">
    <span class="md-ellipsis">
      get_child_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_depth" class="md-nav__link">
    <span class="md-ellipsis">
      get_depth
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_leftmost_leaf" class="md-nav__link">
    <span class="md-ellipsis">
      get_leftmost_leaf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_parameter_leaf_idx" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameter_leaf_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_parent_idx" class="md-nav__link">
    <span class="md-ellipsis">
      get_parent_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.get_subtree" class="md-nav__link">
    <span class="md-ellipsis">
      get_subtree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.pick_random_node" class="md-nav__link">
    <span class="md-ellipsis">
      pick_random_node
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.utils.tree_helper.reconstruct_path" class="md-nav__link">
    <span class="md-ellipsis">
      reconstruct_path
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>tree_helper</h1>

<div class="doc doc-object doc-module">



<a id="gallifrey.utils.tree_helper"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.calculate_max_depth" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_max_depth</span><span class="p">(</span><span class="n">max_nodes</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the maximum depth of the tree that describes the kernel structure,
given the maximum number of nodes in the tree.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_nodes</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of nodes in the tree that describes the kernel structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>On occasion, floating point errors may lead to a depth that is off by one.
This can happen whenever the index is a power of 2. To avoid this, a tolerance
is added to the index before taking the logarithm. By default 1e-10.</p>
              </div>
            </td>
            <td>
                  <code>1e-10</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum depth of the nested kernel structure tree.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_max_depth</span><span class="p">(</span>
    <span class="n">max_nodes</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the maximum depth of the tree that describes the kernel structure,</span>
<span class="sd">    given the maximum number of nodes in the tree.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    max_nodes : ScalarInt</span>
<span class="sd">        The maximum number of nodes in the tree that describes the kernel structure.</span>
<span class="sd">    tolerance : ScalarFloat, optional</span>
<span class="sd">        On occasion, floating point errors may lead to a depth that is off by one.</span>
<span class="sd">        This can happen whenever the index is a power of 2. To avoid this, a tolerance</span>
<span class="sd">        is added to the index before taking the logarithm. By default 1e-10.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarInt</span>
<span class="sd">        The maximum depth of the nested kernel structure tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_depth</span><span class="p">(</span><span class="n">max_nodes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>  <span class="c1"># idx of last node is max_nodes - 1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.calculate_max_leaves" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_max_leaves</span><span class="p">(</span><span class="n">max_depth</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the maximum number of leaves in a binary tree based
on the maximum depth of the tree.
This corresponds to the number of nodes at the maximum depth
of the tree, which is given by 2^max_depth.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_depth</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum depth of the nested kernel structure tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of leaves in the tree that describes the
kernel structure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_max_leaves</span><span class="p">(</span><span class="n">max_depth</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the maximum number of leaves in a binary tree based</span>
<span class="sd">    on the maximum depth of the tree.</span>
<span class="sd">    This corresponds to the number of nodes at the maximum depth</span>
<span class="sd">    of the tree, which is given by 2^max_depth.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    max_depth : ScalarInt</span>
<span class="sd">        The maximum depth of the nested kernel structure tree.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarInt</span>
<span class="sd">        The maximum number of leaves in the tree that describes the</span>
<span class="sd">        kernel structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">**</span><span class="n">max_depth</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.calculate_max_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_max_nodes</span><span class="p">(</span><span class="n">max_depth</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the maximum number of nodes in a binary tree based
on the maximum depth of the tree.
 Since each node in the tree can have at most two children,
the maximum number of nodes in the tree is given by
2^(max_depth + 1) - 1.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_depth</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum depth of the nested kernel structure tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of nodes in the tree that describes the kernel structure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_max_nodes</span><span class="p">(</span><span class="n">max_depth</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the maximum number of nodes in a binary tree based</span>
<span class="sd">    on the maximum depth of the tree.</span>
<span class="sd">     Since each node in the tree can have at most two children,</span>
<span class="sd">    the maximum number of nodes in the tree is given by</span>
<span class="sd">    2^(max_depth + 1) - 1.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    max_depth : ScalarInt</span>
<span class="sd">        The maximum depth of the nested kernel structure tree.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarInt</span>
<span class="sd">        The maximum number of nodes in the tree that describes the kernel structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">max_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.calculate_max_stack_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_max_stack_size</span><span class="p">(</span><span class="n">max_depth</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For a given tree depth, calculate the maximum size of the stack
needed to traverse the tree in level order.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_depth</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum depth of the nested kernel structure tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum size of the stack needed to traverse the tree.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_max_stack_size</span><span class="p">(</span><span class="n">max_depth</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For a given tree depth, calculate the maximum size of the stack</span>
<span class="sd">    needed to traverse the tree in level order.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    max_depth : ScalarInt</span>
<span class="sd">        The maximum depth of the nested kernel structure tree.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarInt</span>
<span class="sd">        The maximum size of the stack needed to traverse the tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">max_depth</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.clear_subtree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_subtree</span><span class="p">(</span><span class="n">tree_expression</span><span class="p">,</span> <span class="n">clear_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Clear a subtree in a level order tree expression.</p>
<p>NOTE: The new tree expression will not be a valid
kernel expression, as the subtree removal leaves
a hole in the expression.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tree_expression</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Int">Int</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tree expression, given in level order notation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>clear_idx</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the root node of the subtree to clear.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_value</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to fill the cleared nodes with. By default
-1.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jaxtyping.Int">Int</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated tree expression with the subtree cleared.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_subtree</span><span class="p">(</span>
    <span class="n">tree_expression</span><span class="p">:</span> <span class="n">Int</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
    <span class="n">clear_idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">fill_value</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clear a subtree in a level order tree expression.</span>

<span class="sd">    NOTE: The new tree expression will not be a valid</span>
<span class="sd">    kernel expression, as the subtree removal leaves</span>
<span class="sd">    a hole in the expression.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tree_expression : Int[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The tree expression, given in level order notation.</span>
<span class="sd">    clear_idx : ScalarInt</span>
<span class="sd">        The index of the root node of the subtree to clear.</span>
<span class="sd">    fill_value : ScalarFloat, optional</span>
<span class="sd">        The value to fill the cleared nodes with. By default</span>
<span class="sd">        -1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Int[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The updated tree expression with the subtree cleared.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_nodes</span> <span class="o">=</span> <span class="n">tree_expression</span><span class="o">.</span><span class="n">size</span>

    <span class="c1"># create initial state</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tree_expression</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">clear_idx</span><span class="p">)</span>
    <span class="n">stack_pointer</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">initial_state</span> <span class="o">=</span> <span class="p">(</span><span class="n">tree_expression</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">stack_pointer</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_clear_subtree</span><span class="p">(</span>
        <span class="n">initial_state</span><span class="p">,</span>
        <span class="n">max_nodes</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.generate_random_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_random_path</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">node_height</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">stop_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">go_left_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate a random path in a binary tree starting from a given index.
Returns the final chosen index, the path taken and the log probability
of reaching the chosen index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="jax.random.PRNGKey">PRNGKey</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The random key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_idx</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the starting node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_depth</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum depth of the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_height</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the subtree at the starting index. This is used
to calculate the maximum number of levels the path can traverse,
and still respect the maximum depth of the tree once the kernel
is reattached.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop_probability</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The probability of stopping at each level, by default 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>go_left_probability</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The probability of choosing the left child at each
level, by default 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the final chosen node (in level order).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jaxtyping.Int">Int</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array of indices representing the path taken, all
parent indices from the start_idx to the final chosen index
(in level order), excluding the final index.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The log probability of reaching the chosen idx. The probability
is calculated by multiplying the probabilities of stopping at
at each index along the path and the probabilities
of choosing the left or right child at each level.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_random_path</span><span class="p">(</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
    <span class="n">start_idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">node_height</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">stop_probability</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">go_left_probability</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
    <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">Int</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
    <span class="n">ScalarFloat</span><span class="p">,</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a random path in a binary tree starting from a given index.</span>
<span class="sd">    Returns the final chosen index, the path taken and the log probability</span>
<span class="sd">    of reaching the chosen index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : jr.PRNGKey</span>
<span class="sd">        The random key.</span>
<span class="sd">    start_idx : ScalarInt</span>
<span class="sd">        The index of the starting node.</span>
<span class="sd">    max_depth : ScalarInt</span>
<span class="sd">        The maximum depth of the tree.</span>
<span class="sd">    node_height : ScalarInt</span>
<span class="sd">        The height of the subtree at the starting index. This is used</span>
<span class="sd">        to calculate the maximum number of levels the path can traverse,</span>
<span class="sd">        and still respect the maximum depth of the tree once the kernel</span>
<span class="sd">        is reattached.</span>
<span class="sd">    stop_probability : ScalarFloat, optional</span>
<span class="sd">        The probability of stopping at each level, by default 0.5.</span>
<span class="sd">    go_left_probability : ScalarFloat, optional</span>
<span class="sd">        The probability of choosing the left child at each</span>
<span class="sd">        level, by default 0.5.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarInt</span>
<span class="sd">        The index of the final chosen node (in level order).</span>
<span class="sd">    Int[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        An array of indices representing the path taken, all</span>
<span class="sd">        parent indices from the start_idx to the final chosen index</span>
<span class="sd">        (in level order), excluding the final index.</span>
<span class="sd">    ScalarFloat</span>
<span class="sd">        The log probability of reaching the chosen idx. The probability</span>
<span class="sd">        is calculated by multiplying the probabilities of stopping at</span>
<span class="sd">        at each index along the path and the probabilities</span>
<span class="sd">        of choosing the left or right child at each level.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">max_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">chosen_idx</span><span class="p">,</span> <span class="n">index_path</span><span class="p">,</span> <span class="n">num_indices</span><span class="p">,</span> <span class="n">idx_log_p</span> <span class="o">=</span> <span class="n">_generate_random_path</span><span class="p">(</span>
        <span class="n">key</span><span class="p">,</span>
        <span class="n">start_idx</span><span class="p">,</span>
        <span class="n">max_depth</span> <span class="o">-</span> <span class="n">node_height</span><span class="p">,</span>
        <span class="n">index_array</span><span class="p">,</span>
        <span class="n">stop_probability</span><span class="p">,</span>
        <span class="n">go_left_probability</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">index_path</span> <span class="o">=</span> <span class="n">index_path</span>

    <span class="k">return</span> <span class="n">chosen_idx</span><span class="p">,</span> <span class="n">index_path</span><span class="p">,</span> <span class="n">idx_log_p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.get_child_idx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_child_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the index of the left or right child of a node in a binary tree,
given by
2 * idx + 1 for left child
2 * idx + 2 for right child.</p>
<p>Compare: https://en.wikipedia.org/wiki/Binary_tree#Arrays</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>direction</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Literal">Literal</span>[<span title="l">l</span>, <span title="r">r</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The side of the child to get. "l" for left child, "r" for right child.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the child.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_child_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the index of the left or right child of a node in a binary tree,</span>
<span class="sd">    given by</span>
<span class="sd">    2 * idx + 1 for left child</span>
<span class="sd">    2 * idx + 2 for right child.</span>

<span class="sd">    Compare: https://en.wikipedia.org/wiki/Binary_tree#Arrays</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    idx : ScalarInt</span>
<span class="sd">        The index of the node.</span>
<span class="sd">    direction : Literal[&quot;l&quot;, &quot;r&quot;]</span>
<span class="sd">        The side of the child to get. &quot;l&quot; for left child, &quot;r&quot; for right child.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarInt</span>
<span class="sd">        The index of the child.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">direction_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;l&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">direction_map</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.get_depth" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_depth</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the depth of a node in a binary tree.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>On occasion, floating point errors may lead to a depth that is off by one.
This can happen whenever the index is a power of 2. To avoid this, a tolerance
is added to the index before taking the logarithm. By default 1e-10.</p>
              </div>
            </td>
            <td>
                  <code>1e-10</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The depth of the node.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_depth</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the depth of a node in a binary tree.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    idx : ScalarInt</span>
<span class="sd">        The index of the node.</span>
<span class="sd">    tolerance : ScalarFloat, optional</span>
<span class="sd">        On occasion, floating point errors may lead to a depth that is off by one.</span>
<span class="sd">        This can happen whenever the index is a power of 2. To avoid this, a tolerance</span>
<span class="sd">        is added to the index before taking the logarithm. By default 1e-10.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        The depth of the node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.get_leftmost_leaf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_leftmost_leaf</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For a tree with a given maximum depth, get the index of the leftmost child
leaf at the maximum depth from a given index (in level order notation).</p>
<p>Since the equation for a left child is 2 * idx + 1, the left child of the left
child is 4<em>i+3, and in general the left-most child at max depth d is
2^(max_depth-current_depth)</em>idx + 2^(max_depth-current_depth)-1 =
2^(max_depth-current_depth)*(idx+1) - 1., which
can be efficiently implemented using bit-shift operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_depth</code>
            </td>
            <td>
                  <code><span title="_type_">_type_</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the leftmost leaf at the maximum depth.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_leftmost_leaf</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For a tree with a given maximum depth, get the index of the leftmost child</span>
<span class="sd">    leaf at the maximum depth from a given index (in level order notation).</span>

<span class="sd">    Since the equation for a left child is 2 * idx + 1, the left child of the left</span>
<span class="sd">    child is 4*i+3, and in general the left-most child at max depth d is</span>
<span class="sd">    2^(max_depth-current_depth)*idx + 2^(max_depth-current_depth)-1 =</span>
<span class="sd">    2^(max_depth-current_depth)*(idx+1) - 1., which</span>
<span class="sd">    can be efficiently implemented using bit-shift operations.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    idx : _type_</span>
<span class="sd">        _description_</span>
<span class="sd">    max_depth : _type_</span>
<span class="sd">        _description_</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarInt</span>
<span class="sd">        The index of the leftmost leaf at the maximum depth.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_depth</span> <span class="o">=</span> <span class="n">get_depth</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">max_depth</span> <span class="o">-</span> <span class="n">current_depth</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">left_shift</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.get_parameter_leaf_idx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parameter_leaf_idx</span><span class="p">(</span><span class="n">tree_level_idx</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the index in the parameter array for a given node in the tree expression.</p>
<p>We work with the convention that, if a leaf node is not at the maximum depth,
the parameters are stored in the leftmost leaf at the maximum depth. Substracting
the index of the very left most leaf (from the root) therefore gives a unique index
for each possible leaf node in the tree.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tree_level_idx</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the node in the tree expression (level order).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_depth</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum depth of the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the parameters in the parameter array for a given node.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_parameter_leaf_idx</span><span class="p">(</span>
    <span class="n">tree_level_idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the index in the parameter array for a given node in the tree expression.</span>

<span class="sd">    We work with the convention that, if a leaf node is not at the maximum depth,</span>
<span class="sd">    the parameters are stored in the leftmost leaf at the maximum depth. Substracting</span>
<span class="sd">    the index of the very left most leaf (from the root) therefore gives a unique index</span>
<span class="sd">    for each possible leaf node in the tree.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tree_level_idx : ScalarInt</span>
<span class="sd">        The index of the node in the tree expression (level order).</span>
<span class="sd">    max_depth : ScalarInt</span>
<span class="sd">        The maximum depth of the tree.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarInt</span>
<span class="sd">        The index of the parameters in the parameter array for a given node.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_leftmost_leaf</span><span class="p">(</span><span class="n">tree_level_idx</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span> <span class="o">-</span> <span class="n">get_leftmost_leaf</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="n">max_depth</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.get_parent_idx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parent_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the index of the parent of a node in a binary tree,
given by floor((idx - 1) / 2).</p>
<p>Compare: https://en.wikipedia.org/wiki/Binary_tree#Arrays</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the parent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_parent_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the index of the parent of a node in a binary tree,</span>
<span class="sd">    given by floor((idx - 1) / 2).</span>

<span class="sd">    Compare: https://en.wikipedia.org/wiki/Binary_tree#Arrays</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    idx : ScalarInt</span>
<span class="sd">        The index of the node.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        The index of the parent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.get_subtree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_subtree</span><span class="p">(</span><span class="n">tree_expression</span><span class="p">,</span> <span class="n">subtree_root_idx</span><span class="p">,</span> <span class="n">new_root_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve a subtree from a level order tree expression, starting
at a given attachment node.</p>
<p>The tree can be re-rooted at a different node, if wanted.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tree_expression</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Int">Int</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tree expression, given in level order notation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subtree_root_idx</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of node where the subtree is rooted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_root_idx</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new index of the root node, if the subtree is to be re-rooted,
by default None. If None, the subtree is returned in its original
location.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jaxtyping.Int">Int</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The (level order) tree expression of the subtree, same length as the
input tree expression.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jaxtyping.Int">Int</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39;2 D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The indices of the nodes in the subtree. Two rows, the first row
contains the indices in the original tree, the second row contains
the indices in the subtree. (Will be the same if the tree is not
re-rooted.)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_subtree</span><span class="p">(</span>
    <span class="n">tree_expression</span><span class="p">:</span> <span class="n">Int</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
    <span class="n">subtree_root_idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">new_root_idx</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ScalarInt</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
    <span class="n">Int</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
    <span class="n">Int</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot;2 D&quot;</span><span class="p">],</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a subtree from a level order tree expression, starting</span>
<span class="sd">    at a given attachment node.</span>

<span class="sd">    The tree can be re-rooted at a different node, if wanted.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tree_expression : Int[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The tree expression, given in level order notation.</span>
<span class="sd">    subtree_root_idx : ScalarInt</span>
<span class="sd">        The index of node where the subtree is rooted.</span>
<span class="sd">    new_root_idx : tp.Optional[ScalarInt], optional</span>
<span class="sd">        The new index of the root node, if the subtree is to be re-rooted,</span>
<span class="sd">        by default None. If None, the subtree is returned in its original</span>
<span class="sd">        location.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Int[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The (level order) tree expression of the subtree, same length as the</span>
<span class="sd">        input tree expression.</span>
<span class="sd">    Int[jnp.ndarray, &quot;2 D&quot;]</span>
<span class="sd">        The indices of the nodes in the subtree. Two rows, the first row</span>
<span class="sd">        contains the indices in the original tree, the second row contains</span>
<span class="sd">        the indices in the subtree. (Will be the same if the tree is not</span>
<span class="sd">        re-rooted.)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_nodes</span> <span class="o">=</span> <span class="n">tree_expression</span><span class="o">.</span><span class="n">size</span>

    <span class="c1"># if tree_expression[subtree_root_idx] == -1:</span>
    <span class="c1">#     raise ValueError(&quot;The start index must be a non-empty node.&quot;)</span>

    <span class="n">new_root_idx</span> <span class="o">=</span> <span class="n">subtree_root_idx</span> <span class="k">if</span> <span class="n">new_root_idx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">new_root_idx</span>

    <span class="c1"># create initial state</span>
    <span class="n">new_tree_expression</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">max_nodes</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">index_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_nodes</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">index_pointer</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new_tree_expression</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">subtree_root_idx</span><span class="p">)</span>
    <span class="n">new_stack</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_root_idx</span><span class="p">)</span>
    <span class="n">stack_pointer</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">initial_state</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">new_tree_expression</span><span class="p">,</span>
        <span class="n">index_array</span><span class="p">,</span>
        <span class="n">index_pointer</span><span class="p">,</span>
        <span class="n">stack</span><span class="p">,</span>
        <span class="n">new_stack</span><span class="p">,</span>
        <span class="n">stack_pointer</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">subtree_expression</span><span class="p">,</span> <span class="n">index_array</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_subtree</span><span class="p">(</span>
        <span class="n">tree_expression</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">,</span>
        <span class="n">max_nodes</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">index_array</span> <span class="o">=</span> <span class="n">index_array</span>
    <span class="c1"># if jnp.any(index_array &gt;= max_nodes):</span>
    <span class="c1">#     raise ValueError(</span>
    <span class="c1">#         &quot;The index array is out of bounds. This could happen if the tree &quot;</span>
    <span class="c1">#         &quot;is re-rooted to a spot where one of its leaves exceeds the &quot;</span>
    <span class="c1">#         &quot;maximum number of nodes.&quot;</span>
    <span class="c1">#     )</span>
    <span class="k">return</span> <span class="n">subtree_expression</span><span class="p">,</span> <span class="n">index_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.pick_random_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pick_random_node</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">post_level_map</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Randomly pick a node from the post-order expression, return the
corresponding node in level order. In the current implementation
this is done by sampling uniformly from the non-empty nodes.</p>
<p>The post_level_map contains all indices used in the the level
order expression, which makes it extremely easy to sample a node
uniformly at random. It is assumed at empty nodes are represented
by -1 in the post_level_map, while all other nodes are have
values &gt;= 0.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rng_key</code>
            </td>
            <td>
                  <code><span title="jaxtyping.PRNGKeyArray">PRNGKeyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>post_level_map</code>
            </td>
            <td>
                  <code> Int[jnp.ndarray, &#34; D&#34;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The map from post-order to level-order.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The randomly chosen node (in level order notation).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pick_random_node</span><span class="p">(</span>
    <span class="n">rng_key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
    <span class="n">post_level_map</span><span class="p">:</span> <span class="n">Int</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Randomly pick a node from the post-order expression, return the</span>
<span class="sd">    corresponding node in level order. In the current implementation</span>
<span class="sd">    this is done by sampling uniformly from the non-empty nodes.</span>

<span class="sd">    The post_level_map contains all indices used in the the level</span>
<span class="sd">    order expression, which makes it extremely easy to sample a node</span>
<span class="sd">    uniformly at random. It is assumed at empty nodes are represented</span>
<span class="sd">    by -1 in the post_level_map, while all other nodes are have</span>
<span class="sd">    values &gt;= 0.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rng_key : PRNGKeyArray</span>
<span class="sd">        Random key.</span>
<span class="sd">    post_level_map :  Int[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The map from post-order to level-order.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarInt</span>
<span class="sd">        The randomly chosen node (in level order notation).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set weights, mask empty nodes</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">post_level_map</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jr</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">post_level_map</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.utils.tree_helper.reconstruct_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reconstruct_path</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">stop_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">go_left_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Given the start index and the end index of a path in a binary tree,
reconstruct the path taken from the start index to the end index and
calculate the log probability of reaching the end index.
(This is the inverse of the generate_random_path function.)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>start_idx</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the starting node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_idx</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the final node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_depth</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum depth of the tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop_probability</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The probability of stopping at each level, by default 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>go_left_probability</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The probability of choosing the left child at each
level, by default 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code> Int[jnp.ndarray, &#34; D&#34;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array of indices representing the path taken, all
parent indices from the start_idx to the final chosen index
(in level order), excluding the final index.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The log probability of reaching the chosen idx. The probability
is calculated by multiplying the probabilities of stopping at
at each index along the path and the probabilities
of choosing the left or right child at each level.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/utils/tree_helper.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_path</span><span class="p">(</span>
    <span class="n">start_idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">end_idx</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">stop_probability</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">go_left_probability</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
    <span class="n">Int</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
    <span class="n">ScalarFloat</span><span class="p">,</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given the start index and the end index of a path in a binary tree,</span>
<span class="sd">    reconstruct the path taken from the start index to the end index and</span>
<span class="sd">    calculate the log probability of reaching the end index.</span>
<span class="sd">    (This is the inverse of the generate_random_path function.)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start_idx : ScalarInt</span>
<span class="sd">        The index of the starting node.</span>
<span class="sd">    end_idx : ScalarInt</span>
<span class="sd">        The index of the final node.</span>
<span class="sd">    max_depth : ScalarInt</span>
<span class="sd">        The maximum depth of the tree.</span>
<span class="sd">    stop_probability : ScalarFloat, optional</span>
<span class="sd">        The probability of stopping at each level, by default 0.5.</span>
<span class="sd">    go_left_probability : ScalarFloat, optional</span>
<span class="sd">        The probability of choosing the left child at each</span>
<span class="sd">        level, by default 0.5.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">     Int[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        An array of indices representing the path taken, all</span>
<span class="sd">        parent indices from the start_idx to the final chosen index</span>
<span class="sd">        (in level order), excluding the final index.</span>
<span class="sd">    ScalarFloat</span>
<span class="sd">        The log probability of reaching the chosen idx. The probability</span>
<span class="sd">        is calculated by multiplying the probabilities of stopping at</span>
<span class="sd">        at each index along the path and the probabilities</span>
<span class="sd">        of choosing the left or right child at each level.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">max_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">path_array</span><span class="p">,</span> <span class="n">num_indices</span><span class="p">,</span> <span class="n">log_probability</span> <span class="o">=</span> <span class="n">_reconstruct_path</span><span class="p">(</span>
        <span class="n">start_idx</span><span class="p">,</span>
        <span class="n">end_idx</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">,</span>
        <span class="n">index_array</span><span class="p">,</span>
        <span class="n">stop_probability</span><span class="p">,</span>
        <span class="n">go_left_probability</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># reverse the path array to get the path from start to end</span>
    <span class="c1"># (NOTE: To keep array static but only reverse filled part,</span>
    <span class="c1"># we reverse the array, then roll last part back to the front).</span>
    <span class="n">path_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">path_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_array</span><span class="p">,</span> <span class="n">log_probability</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy", "content.code.annotate", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>