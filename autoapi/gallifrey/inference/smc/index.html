
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ChrisBoettner.github.io/gallifrey/autoapi/gallifrey/inference/smc/">
      
      
        <link rel="prev" href="../rejuvenation/">
      
      
        <link rel="next" href="../state/">
      
      
      <link rel="icon" href="../../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>smc - gallifrey Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gallifrey.inference.smc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="gallifrey Documentation" class="md-header__button md-logo" aria-label="gallifrey Documentation" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            gallifrey Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              smc
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="lime"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ChrisBoettner/gallifrey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="gallifrey Documentation" class="md-nav__button md-logo" aria-label="gallifrey Documentation" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    gallifrey Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ChrisBoettner/gallifrey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../stellar_variability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time series interpolation and forecasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transit fitting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../comparison_with_simple_kernel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comparison with simple kernel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transmission_spectrum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transmission spectrum of HATS-46 b
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    gallifrey
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            gallifrey
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gpconfig/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gpconfig
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1_3" id="__nav_4_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    inference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            inference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hmc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    hmc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parameter_rejuvenation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameter_rejuvenation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rejuvenation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rejuvenation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    smc
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    smc
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc" class="md-nav__link">
    <span class="md-ellipsis">
      smc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.calculate_effective_sample_size" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_effective_sample_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.calculate_mll_wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_mll_wrapper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.resample_particles" class="md-nav__link">
    <span class="md-ellipsis">
      resample_particles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.reweight_particles" class="md-nav__link">
    <span class="md-ellipsis">
      reweight_particles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.smc_loop" class="md-nav__link">
    <span class="md-ellipsis">
      smc_loop
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.smc_round" class="md-nav__link">
    <span class="md-ellipsis">
      smc_round
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    state
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    transforms
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_4" >
        
          
          <label class="md-nav__link" for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    kernels
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_4">
            <span class="md-nav__icon md-icon"></span>
            kernels
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernels/atoms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    atoms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernels/library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    library
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernels/prior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prior
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernels/tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tree
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_6" >
        
          
          <label class="md-nav__link" for="__nav_4_1_6" id="__nav_4_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    moves
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_6">
            <span class="md-nav__icon md-icon"></span>
            moves
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/acceptance_probability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    acceptance_probability
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/detach_attach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    detach_attach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/noise_proposal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    noise_proposal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/particle_move/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    particle_move
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moves/subtree_replace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    subtree_replace
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parameter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../particles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    particles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    schedule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_10" >
        
          
          <label class="md-nav__link" for="__nav_4_1_10" id="__nav_4_1_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_10">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/probability_calculations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    probability_calculations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/tree_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tree_helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/typing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    typing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc" class="md-nav__link">
    <span class="md-ellipsis">
      smc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.calculate_effective_sample_size" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_effective_sample_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.calculate_mll_wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_mll_wrapper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.resample_particles" class="md-nav__link">
    <span class="md-ellipsis">
      resample_particles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.reweight_particles" class="md-nav__link">
    <span class="md-ellipsis">
      reweight_particles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.smc_loop" class="md-nav__link">
    <span class="md-ellipsis">
      smc_loop
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.inference.smc.smc_round" class="md-nav__link">
    <span class="md-ellipsis">
      smc_round
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>smc</h1>

<div class="doc doc-object doc-module">



<a id="gallifrey.inference.smc"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="gallifrey.inference.smc.calculate_effective_sample_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_effective_sample_size</span><span class="p">(</span><span class="n">log_weights</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculates the effective sample size (ESS) of the particles.</p>
<p>The effective sample size is a measure of how diverse the particle weights are,
and is used to determine whether resampling is needed. If the ESS is low, it means
that many particles have similar weights, and resampling is needed to avoid
degeneracy.</p>
<p>The ESS is calculated as:</p>
<pre><code>ESS = 1 / sum(w^2)
</code></pre>
<p>where w is the normalised(!) weight of each particle.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>log_weights</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; N&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The log weights of the particles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The effective sample size of the particles.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/inference/smc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_effective_sample_size</span><span class="p">(</span>
    <span class="n">log_weights</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; N&quot;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarFloat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the effective sample size (ESS) of the particles.</span>

<span class="sd">    The effective sample size is a measure of how diverse the particle weights are,</span>
<span class="sd">    and is used to determine whether resampling is needed. If the ESS is low, it means</span>
<span class="sd">    that many particles have similar weights, and resampling is needed to avoid</span>
<span class="sd">    degeneracy.</span>

<span class="sd">    The ESS is calculated as:</span>

<span class="sd">        ESS = 1 / sum(w^2)</span>

<span class="sd">    where w is the normalised(!) weight of each particle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    log_weights : Float[jnp.ndarray, &quot; N&quot;]</span>
<span class="sd">        The log weights of the particles.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarFloat</span>
<span class="sd">        The effective sample size of the particles.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">weights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_weights</span><span class="p">)</span>
    <span class="n">ess</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ess</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.inference.smc.calculate_mll_wrapper" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_mll_wrapper</span><span class="p">(</span><span class="n">particle_state</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">kernel_prior</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Wapper around calculate_marginal_log_likelihood, which
calculates the MLL from a particle state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>particle_state</code>
            </td>
            <td>
                  <code><span title="flax.nnx.State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The particle state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Dataset (gallifrey.data.Dataset)" href="../../data/#gallifrey.data.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset object, containing the input x and output y.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kernel_prior</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="KernelPrior (gallifrey.kernels.prior.KernelPrior)" href="../../kernels/prior/#gallifrey.kernels.prior.KernelPrior">KernelPrior</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kernel prior, used to reconstruct the kernel.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The marginal log likelihood for the given particle state and
subset of the data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/inference/smc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_mll_wrapper</span><span class="p">(</span>
    <span class="n">particle_state</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
    <span class="n">kernel_prior</span><span class="p">:</span> <span class="n">KernelPrior</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarFloat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wapper around calculate_marginal_log_likelihood, which</span>
<span class="sd">    calculates the MLL from a particle state.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    particle_state : nnx.State</span>
<span class="sd">        The particle state.</span>
<span class="sd">    data : Dataset</span>
<span class="sd">        The dataset object, containing the input x and output y.</span>
<span class="sd">    kernel_prior : KernelPrior</span>
<span class="sd">        The kernel prior, used to reconstruct the kernel.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScalarFloat</span>
<span class="sd">        The marginal log likelihood for the given particle state and</span>
<span class="sd">        subset of the data.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel_prior</span><span class="o">.</span><span class="n">reconstruct_kernel</span><span class="p">(</span><span class="n">particle_state</span><span class="o">.</span><span class="n">kernel</span><span class="p">)</span>
    <span class="n">kernel_gram</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">_gram_train</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

    <span class="n">noise_variance</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">particle_state</span><span class="o">.</span><span class="n">noise_variance</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="n">mll</span> <span class="o">=</span> <span class="n">calculate_marginal_log_likelihood</span><span class="p">(</span>
        <span class="n">kernel_gram</span><span class="p">,</span>
        <span class="n">noise_variance</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">mll</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.inference.smc.resample_particles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_particles</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">particle_states</span><span class="p">,</span> <span class="n">log_weights</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">,</span> <span class="n">resampling_func</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Resamples particles based on the log weights.</p>
<p>This function resamples the particles based on the log weights
using a resampling function, which takes the log weights and
the number of particles and returns the indices of the resampled
particles.</p>
<p>The resampling function must have the signature:
    resampling_func(key, weights, num_particles) -&gt; jnp.ndarray</p>
<p>Note that the actual weights must be passed to the resampling function
(not the log weights), and that they need to be normalised.</p>
<p>We use sampling functions from blackjax. By default we use stratified
resampling, but systematic, multinomial, and residual resampling are also
available.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="jaxtyping.PRNGKeyArray">PRNGKeyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The random key for the resampling function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>particle_states</code>
            </td>
            <td>
                  <code><span title="flax.nnx.State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current particle states.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_weights</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; N&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The log weights of the particles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_particles</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of particles (should be the same as the length of the log weights,
and the number of particles in the particle_states).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resampling_func</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resampling function to use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="flax.nnx.State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resampled particle states.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; N&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The normalised log weights of the resampled particles.
(i.e. log(1/N) for each particle, see Saad2023, algorithm 1 line 9).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/inference/smc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;num_particles&quot;</span><span class="p">,</span> <span class="s2">&quot;resampling_func&quot;</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">resample_particles</span><span class="p">(</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
    <span class="n">particle_states</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span>
    <span class="n">log_weights</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; N&quot;</span><span class="p">],</span>
    <span class="n">num_particles</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">resampling_func</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">Float</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; N&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resamples particles based on the log weights.</span>

<span class="sd">    This function resamples the particles based on the log weights</span>
<span class="sd">    using a resampling function, which takes the log weights and</span>
<span class="sd">    the number of particles and returns the indices of the resampled</span>
<span class="sd">    particles.</span>

<span class="sd">    The resampling function must have the signature:</span>
<span class="sd">        resampling_func(key, weights, num_particles) -&gt; jnp.ndarray</span>

<span class="sd">    Note that the actual weights must be passed to the resampling function</span>
<span class="sd">    (not the log weights), and that they need to be normalised.</span>

<span class="sd">    We use sampling functions from blackjax. By default we use stratified</span>
<span class="sd">    resampling, but systematic, multinomial, and residual resampling are also</span>
<span class="sd">    available.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : PRNGKeyArray</span>
<span class="sd">        The random key for the resampling function.</span>
<span class="sd">    particle_states : nnx.State</span>
<span class="sd">        The current particle states.</span>
<span class="sd">    log_weights : Float[jnp.ndarray, &quot; N&quot;]</span>
<span class="sd">        The log weights of the particles.</span>
<span class="sd">    num_particles : ScalarInt</span>
<span class="sd">        The number of particles (should be the same as the length of the log weights,</span>
<span class="sd">        and the number of particles in the particle_states).</span>
<span class="sd">    resampling_func : tp.Callable</span>
<span class="sd">        The resampling function to use.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nnx.State</span>
<span class="sd">        The resampled particle states.</span>
<span class="sd">    Float[jnp.ndarray, &quot; N&quot;]</span>
<span class="sd">        The normalised log weights of the resampled particles.</span>
<span class="sd">        (i.e. log(1/N) for each particle, see Saad2023, algorithm 1 line 9).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># sample indices based on weights</span>
    <span class="n">sampled_indices</span> <span class="o">=</span> <span class="n">resampling_func</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_weights</span><span class="p">),</span> <span class="n">num_particles</span><span class="p">)</span>

    <span class="c1"># update particle states based on sampled indices</span>
    <span class="n">resampled_state</span> <span class="o">=</span> <span class="n">jtu</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">leaf</span><span class="p">:</span> <span class="n">leaf</span><span class="p">[</span><span class="n">sampled_indices</span><span class="p">],</span> <span class="n">particle_states</span><span class="p">)</span>

    <span class="n">resampled_log_weights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_particles</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_particles</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">resampled_state</span><span class="p">,</span> <span class="n">resampled_log_weights</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.inference.smc.reweight_particles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reweight_particles</span><span class="p">(</span><span class="n">smc_state</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">kernel_prior</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reweights particles based on the marginal log likelihood
calculated with new data points.</p>
<p>This function updates the log weights of the particles in the SMC state by
calculating the marginal log likelihood for each particle using the new subset
vs the previous subset, taking the difference in MLL for each particle and adding
it to the existing log weights, in essence:</p>
<pre><code>w_t = w_{t-1} * (mll_t / mll_{t-1}) (but in log space, so addition instead)
</code></pre>
<p>See Saad2023, algorithm 1 line 5.</p>
<p>The weights are returned normalised.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>smc_state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="../state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The SMC state after the previous round.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Dataset (gallifrey.data.Dataset)" href="../../data/#gallifrey.data.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset containing the data at the current time point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kernel_prior</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="KernelPrior (gallifrey.kernels.prior.KernelPrior)" href="../../kernels/prior/#gallifrey.kernels.prior.KernelPrior">KernelPrior</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kernel prior object, used to construct the kernel.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; N&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated (normalised) log weights for the particles.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/inference/smc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;kernel_prior&quot;</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">reweight_particles</span><span class="p">(</span>
    <span class="n">smc_state</span><span class="p">:</span> <span class="n">GPState</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
    <span class="n">kernel_prior</span><span class="p">:</span> <span class="n">KernelPrior</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Float</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; N&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reweights particles based on the marginal log likelihood</span>
<span class="sd">    calculated with new data points.</span>

<span class="sd">    This function updates the log weights of the particles in the SMC state by</span>
<span class="sd">    calculating the marginal log likelihood for each particle using the new subset</span>
<span class="sd">    vs the previous subset, taking the difference in MLL for each particle and adding</span>
<span class="sd">    it to the existing log weights, in essence:</span>

<span class="sd">        w_t = w_{t-1} * (mll_t / mll_{t-1}) (but in log space, so addition instead)</span>

<span class="sd">    See Saad2023, algorithm 1 line 5.</span>

<span class="sd">    The weights are returned normalised.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    smc_state : GPState</span>
<span class="sd">        The SMC state after the previous round.</span>
<span class="sd">    data : Dataset</span>
<span class="sd">        The dataset containing the data at the current time point.</span>
<span class="sd">    kernel_prior : KernelPrior</span>
<span class="sd">        The kernel prior object, used to construct the kernel.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Float[jnp.ndarray, &quot; N&quot;]</span>
<span class="sd">        The updated (normalised) log weights for the particles.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">new_mlls</span> <span class="o">=</span> <span class="n">vmap</span><span class="p">(</span><span class="n">calculate_mll_wrapper</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span>
        <span class="n">smc_state</span><span class="o">.</span><span class="n">particle_states</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">kernel_prior</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">mll_ratio</span> <span class="o">=</span> <span class="n">new_mlls</span> <span class="o">-</span> <span class="n">smc_state</span><span class="o">.</span><span class="n">marginal_log_likelihoods</span>  <span class="c1"># type: ignore</span>

    <span class="n">unnorm_log_weights</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">smc_state</span><span class="o">.</span><span class="n">log_weights</span> <span class="o">+</span> <span class="n">mll_ratio</span>  <span class="c1"># type: ignore</span>
    <span class="n">log_weights</span> <span class="o">=</span> <span class="n">unnorm_log_weights</span> <span class="o">-</span> <span class="n">logsumexp</span><span class="p">(</span><span class="n">unnorm_log_weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log_weights</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.inference.smc.smc_loop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smc_loop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">particle_states</span><span class="p">,</span> <span class="n">annealing_schedule</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">kernel_prior</span><span class="p">,</span> <span class="n">noise_prior</span><span class="p">,</span> <span class="n">fix_noise</span><span class="p">,</span> <span class="n">hmc_sampler_factory</span><span class="p">,</span> <span class="n">n_mcmc</span><span class="p">,</span> <span class="n">n_hmc</span><span class="p">,</span> <span class="n">resampling_func</span><span class="o">=</span><span class="n">stratified</span><span class="p">,</span> <span class="n">ess_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Runs the Sequential Monte Carlo (SMC) algorithm.</p>
<p>The SMC loop runs a series of SMC rounds using a data annealing
schedule, each round includes three steps:</p>
<ul>
<li>
<p>Reweighting: Update particle weights based on new data.
The new weight is the old weight times the ratio of the new
marginal likelihood evaluated on the new data (so all data up
to n_t, where n_t is the number of data points at time t in
the annealing schedule) and the old marginal likelihood evaluated
on the previous data (up to n_{t-1}). In essence, the new weight
reflect how much better the particle fits the new (unseen) data
compared to the data it was trained on.</p>
</li>
<li>
<p>Resampling: Adaptively resample particles based on the new weights.
This step is performed if the effective sample size (ESS) is below a
threshold (0.5 in this implementation). The ESS is a measure of how
diverse the particle weights are, and if it is low, it means that many
particles have similar weights, and resampling is needed to avoid
degeneracy. There are various resampling strategies available, we
default to stratified resampling.</p>
</li>
<li>
<p>Rejuvenation: Rejuvenate particles using MCMC and HMC steps. This
step is performed on all particles, and consists of two main moves:</p>
<ol>
<li>Structure Move: Proposes a new kernel structure based on the
<code>kernel_prior</code>.</li>
<li>Parameter Rejuvenation: If the structure move is accepted,
rejuvenates the kernel parameters and potentially the noise variance
using Hamiltonian Monte Carlo (HMC).</li>
</ol>
</li>
</ul>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="jaxtyping.PRNGKeyArray">PRNGKeyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The random key used for sampling.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>particle_states</code>
            </td>
            <td>
                  <code><span title="flax.nnx.State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The particle states at the start of the SMC loop.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annealing_schedule</code>
            </td>
            <td>
                  <code><span title="Int">Int</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; T&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The annealing schedule, an array of integers representing
the number of data points to use at each time point
(e.g. jnp.array([10, 20, 30, 40, 50]) ).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_particles</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of particles (must match number of particles
in the particle_states).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Dataset (gallifrey.data.Dataset)" href="../../data/#gallifrey.data.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset object containing the input x and output y for
all data points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kernel_prior</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="KernelPrior (gallifrey.kernels.prior.KernelPrior)" href="../../kernels/prior/#gallifrey.kernels.prior.KernelPrior">KernelPrior</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kernel prior object, used to reconstruct the kernel, and sample
new kernel structures.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>noise_prior</code>
            </td>
            <td>
                  <code><span title="tensorflow_probability.substrates.jax.distributions.Distribution">Distribution</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prior distribution for the noise variance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fix_noise</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fix the noise variance during rejuvenation, or sample it.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hmc_sampler_factory</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A factory function that creates an HMC sampler instance for the parameter
rejuvenation step.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_mcmc</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of MCMC steps to perform during rejuvenation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_hmc</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of HMC steps to perform during rejuvenation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resampling_func</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resampling function to use, by default stratified.</p>
              </div>
            </td>
            <td>
                  <code><span title="blackjax.smc.resampling.stratified">stratified</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ess_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The threshold for the effective sample size (ESS) below which
resampling is performed, by default 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbosity</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The verbosity level for the rejuvenation process. Debug information
is printed if verbosity &gt; 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="../state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The final SMC state after the SMC loop.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="../state/#gallifrey.inference.state.GPState">GPState</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The full history of the SMC state at each time point in the
annealing schedule.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/inference/smc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">smc_loop</span><span class="p">(</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
    <span class="n">particle_states</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span>
    <span class="n">annealing_schedule</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">num_particles</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
    <span class="n">kernel_prior</span><span class="p">:</span> <span class="n">KernelPrior</span><span class="p">,</span>
    <span class="n">noise_prior</span><span class="p">:</span> <span class="n">Distribution</span><span class="p">,</span>
    <span class="n">fix_noise</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">hmc_sampler_factory</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span>
    <span class="n">n_mcmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">n_hmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">resampling_func</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Callable</span> <span class="o">=</span> <span class="n">stratified</span><span class="p">,</span>
    <span class="n">ess_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="p">:</span> <span class="n">ScalarInt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">GPState</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">GPState</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the Sequential Monte Carlo (SMC) algorithm.</span>

<span class="sd">    The SMC loop runs a series of SMC rounds using a data annealing</span>
<span class="sd">    schedule, each round includes three steps:</span>

<span class="sd">    - Reweighting: Update particle weights based on new data.</span>
<span class="sd">    The new weight is the old weight times the ratio of the new</span>
<span class="sd">    marginal likelihood evaluated on the new data (so all data up</span>
<span class="sd">    to n_t, where n_t is the number of data points at time t in</span>
<span class="sd">    the annealing schedule) and the old marginal likelihood evaluated</span>
<span class="sd">    on the previous data (up to n_{t-1}). In essence, the new weight</span>
<span class="sd">    reflect how much better the particle fits the new (unseen) data</span>
<span class="sd">    compared to the data it was trained on.</span>

<span class="sd">    - Resampling: Adaptively resample particles based on the new weights.</span>
<span class="sd">    This step is performed if the effective sample size (ESS) is below a</span>
<span class="sd">    threshold (0.5 in this implementation). The ESS is a measure of how</span>
<span class="sd">    diverse the particle weights are, and if it is low, it means that many</span>
<span class="sd">    particles have similar weights, and resampling is needed to avoid</span>
<span class="sd">    degeneracy. There are various resampling strategies available, we</span>
<span class="sd">    default to stratified resampling.</span>

<span class="sd">    - Rejuvenation: Rejuvenate particles using MCMC and HMC steps. This</span>
<span class="sd">    step is performed on all particles, and consists of two main moves:</span>
<span class="sd">        1. Structure Move: Proposes a new kernel structure based on the</span>
<span class="sd">        `kernel_prior`.</span>
<span class="sd">        2. Parameter Rejuvenation: If the structure move is accepted,</span>
<span class="sd">        rejuvenates the kernel parameters and potentially the noise variance</span>
<span class="sd">        using Hamiltonian Monte Carlo (HMC).</span>



<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : PRNGKeyArray</span>
<span class="sd">        The random key used for sampling.</span>
<span class="sd">    particle_states : nnx.State</span>
<span class="sd">        The particle states at the start of the SMC loop.</span>
<span class="sd">    annealing_schedule : Int[jnp.ndarray, &quot; T&quot;]</span>
<span class="sd">        The annealing schedule, an array of integers representing</span>
<span class="sd">        the number of data points to use at each time point</span>
<span class="sd">        (e.g. jnp.array([10, 20, 30, 40, 50]) ).</span>
<span class="sd">    num_particles : int</span>
<span class="sd">        The number of particles (must match number of particles</span>
<span class="sd">        in the particle_states).</span>
<span class="sd">    data : Dataset</span>
<span class="sd">        The dataset object containing the input x and output y for</span>
<span class="sd">        all data points.</span>
<span class="sd">    kernel_prior : KernelPrior</span>
<span class="sd">        The kernel prior object, used to reconstruct the kernel, and sample</span>
<span class="sd">        new kernel structures.</span>
<span class="sd">    noise_prior : Distribution</span>
<span class="sd">        The prior distribution for the noise variance.</span>
<span class="sd">    fix_noise : bool</span>
<span class="sd">        Whether to fix the noise variance during rejuvenation, or sample it.</span>
<span class="sd">    hmc_sampler_factory : tp.Callable</span>
<span class="sd">        A factory function that creates an HMC sampler instance for the parameter</span>
<span class="sd">        rejuvenation step.</span>
<span class="sd">    n_mcmc : ScalarInt</span>
<span class="sd">        The number of MCMC steps to perform during rejuvenation.</span>
<span class="sd">    n_hmc : ScalarInt</span>
<span class="sd">        The number of HMC steps to perform during rejuvenation.</span>
<span class="sd">    resampling_func : tp.Callable, optional</span>
<span class="sd">        The resampling function to use, by default stratified.</span>
<span class="sd">    ess_threshold : float, optional</span>
<span class="sd">        The threshold for the effective sample size (ESS) below which</span>
<span class="sd">        resampling is performed, by default 0.5.</span>
<span class="sd">    verbosity : int, optional</span>
<span class="sd">        The verbosity level for the rejuvenation process. Debug information</span>
<span class="sd">        is printed if verbosity &gt; 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GPState</span>
<span class="sd">        The final SMC state after the SMC loop.</span>
<span class="sd">    list[GPState]</span>
<span class="sd">        The full history of the SMC state at each time point in the</span>
<span class="sd">        annealing schedule.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">smc_round_wrapper</span><span class="p">(</span>
        <span class="n">smc_state</span><span class="p">:</span> <span class="n">GPState</span><span class="p">,</span>
        <span class="n">points_to_use</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GPState</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper around the smc_round function.&quot;&quot;&quot;</span>

        <span class="n">x_slice</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="n">points_to_use</span><span class="p">,))</span>
        <span class="n">y_slice</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="n">points_to_use</span><span class="p">,))</span>

        <span class="n">kernel_prior_round</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">kernel_prior</span><span class="p">)</span>
        <span class="n">kernel_prior_round</span><span class="o">.</span><span class="n">num_datapoints</span> <span class="o">=</span> <span class="n">points_to_use</span>

        <span class="n">data_subset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_slice</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_slice</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">smc_round</span><span class="p">(</span>
            <span class="n">smc_state</span><span class="p">,</span>
            <span class="n">num_particles</span><span class="p">,</span>
            <span class="n">n_mcmc</span><span class="p">,</span>
            <span class="n">n_hmc</span><span class="p">,</span>
            <span class="n">data_subset</span><span class="p">,</span>
            <span class="n">kernel_prior_round</span><span class="p">,</span>
            <span class="n">noise_prior</span><span class="p">,</span>
            <span class="n">fix_noise</span><span class="p">,</span>
            <span class="n">hmc_sampler_factory</span><span class="p">,</span>
            <span class="n">resampling_func</span><span class="p">,</span>
            <span class="n">ess_threshold</span><span class="p">,</span>
            <span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">verbosity</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># initialise SMC state</span>
    <span class="n">initial_smc_state</span> <span class="o">=</span> <span class="n">GPState</span><span class="p">(</span>
        <span class="n">particle_states</span><span class="o">=</span><span class="n">particle_states</span><span class="p">,</span>
        <span class="n">log_weights</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_particles</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_particles</span><span class="p">),</span>
        <span class="n">marginal_log_likelihoods</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_particles</span><span class="p">),</span>
        <span class="n">num_particles</span><span class="o">=</span><span class="n">num_particles</span><span class="p">,</span>
        <span class="n">num_data_points</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">resampled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mcmc_accepted</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_particles</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="n">hmc_accepted</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_particles</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">points_to_use</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">annealing_schedule</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Running SMC round [</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">annealing_schedule</span><span class="p">)</span><span class="si">}</span><span class="s2">] &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with [</span><span class="si">{</span><span class="n">points_to_use</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2">] data points.&quot;</span>
            <span class="p">)</span>

        <span class="n">final_smc_state</span> <span class="o">=</span> <span class="n">smc_round_wrapper</span><span class="p">(</span>
            <span class="n">initial_smc_state</span><span class="p">,</span>
            <span class="n">points_to_use</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">initial_smc_state</span> <span class="o">=</span> <span class="n">final_smc_state</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_smc_state</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_smc_state</span><span class="p">,</span> <span class="n">history</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="gallifrey.inference.smc.smc_round" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smc_round</span><span class="p">(</span><span class="n">smc_state</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">,</span> <span class="n">n_mcmc</span><span class="p">,</span> <span class="n">n_hmc</span><span class="p">,</span> <span class="n">data_subset</span><span class="p">,</span> <span class="n">kernel_prior</span><span class="p">,</span> <span class="n">noise_prior</span><span class="p">,</span> <span class="n">fix_noise</span><span class="p">,</span> <span class="n">hmc_sampler_factory</span><span class="p">,</span> <span class="n">resampling_func</span><span class="p">,</span> <span class="n">ess_threshold</span><span class="p">,</span> <span class="n">total_data_points</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Performs one round of Sequential Monte Carlo (SMC).</p>
<p>This function executes a single SMC round, which includes reweighting particles
based on new data, resampling particles if the effective sample size is below
a threshold, and rejuvenating particles using MCMC and HMC steps.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>smc_state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="../state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current SMC state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_particles</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of particles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_mcmc</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of MCMC steps to perform during rejuvenation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_hmc</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of HMC steps within each MCMC step during rejuvenation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_subset</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Dataset (gallifrey.data.Dataset)" href="../../data/#gallifrey.data.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data to be considered for this SMC round.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kernel_prior</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="KernelPrior (gallifrey.kernels.prior.KernelPrior)" href="../../kernels/prior/#gallifrey.kernels.prior.KernelPrior">KernelPrior</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kernel prior object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>noise_prior</code>
            </td>
            <td>
                  <code><span title="tensorflow_probability.substrates.jax.distributions.Distribution">Distribution</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prior distribution for the noise parameter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fix_noise</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fix the noise parameter during rejuvenation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hmc_sampler_factory</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A factory function that creates an HMC sampler.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resampling_func</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resampling function to use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ess_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The threshold for the effective sample size (ESS) below which
resampling is performed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_data_points</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total number of data points in the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbosity</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The verbosity level for the rejuvenation process. Debug information
is printed if verbosity &gt; 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SMState">SMState</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated SMC state after the round.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/inference/smc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">smc_round</span><span class="p">(</span>
    <span class="n">smc_state</span><span class="p">:</span> <span class="n">GPState</span><span class="p">,</span>
    <span class="n">num_particles</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">n_mcmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">n_hmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">data_subset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
    <span class="n">kernel_prior</span><span class="p">:</span> <span class="n">KernelPrior</span><span class="p">,</span>
    <span class="n">noise_prior</span><span class="p">:</span> <span class="n">Distribution</span><span class="p">,</span>
    <span class="n">fix_noise</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">hmc_sampler_factory</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span>
    <span class="n">resampling_func</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span>
    <span class="n">ess_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">total_data_points</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="p">:</span> <span class="n">ScalarInt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GPState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs one round of Sequential Monte Carlo (SMC).</span>

<span class="sd">    This function executes a single SMC round, which includes reweighting particles</span>
<span class="sd">    based on new data, resampling particles if the effective sample size is below</span>
<span class="sd">    a threshold, and rejuvenating particles using MCMC and HMC steps.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    smc_state : GPState</span>
<span class="sd">        The current SMC state.</span>
<span class="sd">    num_particles : ScalarInt</span>
<span class="sd">        The number of particles.</span>
<span class="sd">    n_mcmc : ScalarInt</span>
<span class="sd">        The number of MCMC steps to perform during rejuvenation.</span>
<span class="sd">    n_hmc : ScalarInt</span>
<span class="sd">        The number of HMC steps within each MCMC step during rejuvenation.</span>
<span class="sd">    data_subset : Dataset</span>
<span class="sd">        The data to be considered for this SMC round.</span>
<span class="sd">    kernel_prior : KernelPrior</span>
<span class="sd">        The kernel prior object.</span>
<span class="sd">    noise_prior : Distribution</span>
<span class="sd">        The prior distribution for the noise parameter.</span>
<span class="sd">    fix_noise : bool</span>
<span class="sd">        Whether to fix the noise parameter during rejuvenation.</span>
<span class="sd">    hmc_sampler_factory : tp.Callable</span>
<span class="sd">        A factory function that creates an HMC sampler.</span>
<span class="sd">    resampling_func : tp.Callable</span>
<span class="sd">        The resampling function to use.</span>
<span class="sd">    ess_threshold : float</span>
<span class="sd">        The threshold for the effective sample size (ESS) below which</span>
<span class="sd">        resampling is performed.</span>
<span class="sd">    total_data_points : ScalarInt</span>
<span class="sd">        The total number of data points in the dataset.</span>
<span class="sd">    verbosity : ScalarInt, optional</span>
<span class="sd">        The verbosity level for the rejuvenation process. Debug information</span>
<span class="sd">        is printed if verbosity &gt; 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SMState</span>
<span class="sd">        The updated SMC state after the round.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span><span class="p">,</span> <span class="n">resample_key</span><span class="p">,</span> <span class="n">rejuvenate_key</span><span class="p">,</span> <span class="n">state_key</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
        <span class="n">smc_state</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
        <span class="mi">4</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># reweight</span>
    <span class="n">new_log_weights</span> <span class="o">=</span> <span class="n">reweight_particles</span><span class="p">(</span>
        <span class="n">smc_state</span><span class="p">,</span>
        <span class="n">data_subset</span><span class="p">,</span>
        <span class="n">kernel_prior</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weights: </span><span class="si">{</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">new_log_weights</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># get number of data points for this round</span>
    <span class="n">num_data_points</span> <span class="o">=</span> <span class="n">data_subset</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># maybe resample, depending on effective sample size (ESS)</span>
    <span class="c1"># (if resample, also reset log weights to uniform)</span>
    <span class="n">normalised_ess</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">calculate_effective_sample_size</span><span class="p">(</span><span class="n">new_log_weights</span><span class="p">)</span>
        <span class="o">/</span> <span class="n">smc_state</span><span class="o">.</span><span class="n">num_particles</span>  <span class="c1"># type: ignore</span>
    <span class="p">)</span>
    <span class="c1"># do not resample if we are at last step</span>
    <span class="n">do_resample</span> <span class="o">=</span> <span class="p">(</span><span class="n">normalised_ess</span> <span class="o">&lt;</span> <span class="n">ess_threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="n">num_data_points</span> <span class="o">&lt;</span> <span class="n">total_data_points</span>
    <span class="p">)</span>

    <span class="n">resampled_particle_states</span><span class="p">,</span> <span class="n">new_log_weights</span><span class="p">,</span> <span class="n">resampled</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">do_resample</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">key</span><span class="p">:</span> <span class="p">(</span>
            <span class="o">*</span><span class="n">resample_particles</span><span class="p">(</span>
                <span class="n">resample_key</span><span class="p">,</span>
                <span class="n">smc_state</span><span class="o">.</span><span class="n">particle_states</span><span class="p">,</span>
                <span class="n">new_log_weights</span><span class="p">,</span>
                <span class="n">num_particles</span><span class="p">,</span>
                <span class="n">resampling_func</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="kc">True</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="k">lambda</span> <span class="n">key</span><span class="p">:</span> <span class="p">(</span><span class="n">smc_state</span><span class="o">.</span><span class="n">particle_states</span><span class="p">,</span> <span class="n">new_log_weights</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">key</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Resampled: </span><span class="si">{</span><span class="n">resampled</span><span class="si">}</span><span class="s2"> (Normalised ESS: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">normalised_ess</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>

    <span class="c1"># rejuvenate</span>
    <span class="nd">@jit</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">ScalarInt</span><span class="p">,</span> <span class="n">ScalarInt</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper around the rejuvenate_particle function using</span>
<span class="sd">        GPmodel attributes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rejuvenate_particle</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">state</span><span class="p">,</span>
            <span class="n">data_subset</span><span class="p">,</span>
            <span class="n">kernel_prior</span><span class="p">,</span>
            <span class="n">noise_prior</span><span class="p">,</span>
            <span class="n">n_mcmc</span><span class="o">=</span><span class="n">n_mcmc</span><span class="p">,</span>
            <span class="n">n_hmc</span><span class="o">=</span><span class="n">n_hmc</span><span class="p">,</span>
            <span class="n">fix_noise</span><span class="o">=</span><span class="n">fix_noise</span><span class="p">,</span>
            <span class="n">hmc_sampler_factory</span><span class="o">=</span><span class="n">hmc_sampler_factory</span><span class="p">,</span>
            <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># run rejuvenation on all particles, parallelised</span>
    <span class="n">final_state</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">accepted_mcmc</span><span class="p">,</span> <span class="n">accepted_hmc</span> <span class="o">=</span> <span class="n">pmap</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)(</span>
        <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rejuvenate_key</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
        <span class="n">resampled_particle_states</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">acc_mcmc</span><span class="p">,</span> <span class="n">acc_hmc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="n">smc_state</span><span class="o">.</span><span class="n">num_particles</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
            <span class="n">accepted_mcmc</span><span class="p">,</span>
            <span class="n">accepted_hmc</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Particle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> | Accepted: MCMC[</span><span class="si">{</span><span class="n">acc_mcmc</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_mcmc</span><span class="si">}</span><span class="s2">] &quot;</span>
                <span class="sa">f</span><span class="s2">&quot; HMC[</span><span class="si">{</span><span class="n">acc_hmc</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">acc_mcmc</span><span class="o">*</span><span class="n">n_hmc</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="c1"># calculate annealing MLL</span>
    <span class="n">new_mlls</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="n">jit</span><span class="p">(</span>
            <span class="n">vmap</span><span class="p">(</span><span class="n">calculate_mll_wrapper</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;kernel_prior&quot;</span><span class="p">),</span>
        <span class="p">)(</span>
            <span class="n">final_state</span><span class="p">,</span>
            <span class="n">data_subset</span><span class="p">,</span>
            <span class="n">kernel_prior</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">GPState</span><span class="p">(</span>
        <span class="n">particle_states</span><span class="o">=</span><span class="n">final_state</span><span class="p">,</span>
        <span class="n">log_weights</span><span class="o">=</span><span class="n">new_log_weights</span><span class="p">,</span>
        <span class="n">marginal_log_likelihoods</span><span class="o">=</span><span class="n">new_mlls</span><span class="p">,</span>
        <span class="n">num_particles</span><span class="o">=</span><span class="n">smc_state</span><span class="o">.</span><span class="n">num_particles</span><span class="p">,</span>
        <span class="n">num_data_points</span><span class="o">=</span><span class="n">num_data_points</span><span class="p">,</span>
        <span class="n">resampled</span><span class="o">=</span><span class="n">resampled</span><span class="p">,</span>
        <span class="n">mcmc_accepted</span><span class="o">=</span><span class="n">accepted_mcmc</span><span class="p">,</span>
        <span class="n">hmc_accepted</span><span class="o">=</span><span class="n">accepted_hmc</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">state_key</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy", "content.code.annotate", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>