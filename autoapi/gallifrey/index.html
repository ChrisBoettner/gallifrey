
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ChrisBoettner.github.io/gallifrey/autoapi/gallifrey/">
      
      
        <link rel="prev" href="../../transmission_spectrum/">
      
      
        <link rel="next" href="data/">
      
      
      <link rel="icon" href="../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>gallifrey - gallifrey Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gallifrey" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="gallifrey Documentation" class="md-header__button md-logo" aria-label="gallifrey Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            gallifrey Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              gallifrey
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="lime"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ChrisBoettner/gallifrey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="gallifrey Documentation" class="md-nav__button md-logo" aria-label="gallifrey Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    gallifrey Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ChrisBoettner/gallifrey" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stellar_variability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time series interpolation and forecasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transit fitting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../comparison_with_simple_kernel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comparison with simple kernel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transmission_spectrum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transmission spectrum of HATS-46 b
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    gallifrey
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            gallifrey
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gpconfig/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gpconfig
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_3" >
        
          
          <label class="md-nav__link" for="__nav_4_1_3" id="__nav_4_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    inference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            inference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="inference/hmc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    hmc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="inference/parameter_rejuvenation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameter_rejuvenation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="inference/rejuvenation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rejuvenation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="inference/smc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    smc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="inference/state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    state
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="inference/transforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    transforms
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_4" >
        
          
          <label class="md-nav__link" for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    kernels
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_4">
            <span class="md-nav__icon md-icon"></span>
            kernels
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="kernels/atoms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    atoms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="kernels/library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    library
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="kernels/prior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prior
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="kernels/tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tree
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_6" >
        
          
          <label class="md-nav__link" for="__nav_4_1_6" id="__nav_4_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    moves
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_6">
            <span class="md-nav__icon md-icon"></span>
            moves
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="moves/acceptance_probability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    acceptance_probability
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="moves/detach_attach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    detach_attach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="moves/noise_proposal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    noise_proposal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="moves/particle_move/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    particle_move
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="moves/subtree_replace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    subtree_replace
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="parameter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="particles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    particles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    schedule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_10" >
        
          
          <label class="md-nav__link" for="__nav_4_1_10" id="__nav_4_1_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_10">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="utils/probability_calculations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    probability_calculations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="utils/tree_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tree_helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="utils/typing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    typing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gallifrey" class="md-nav__link">
    <span class="md-ellipsis">
      gallifrey
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.GPConfig" class="md-nav__link">
    <span class="md-ellipsis">
      GPConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPConfig.noise_prior" class="md-nav__link">
    <span class="md-ellipsis">
      noise_prior
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.GPModel" class="md-nav__link">
    <span class="md-ellipsis">
      GPModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.kernel_library" class="md-nav__link">
    <span class="md-ellipsis">
      kernel_library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.noise_prior" class="md-nav__link">
    <span class="md-ellipsis">
      noise_prior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.num_particles" class="md-nav__link">
    <span class="md-ellipsis">
      num_particles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.display" class="md-nav__link">
    <span class="md-ellipsis">
      display
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.fit_mcmc" class="md-nav__link">
    <span class="md-ellipsis">
      fit_mcmc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.fit_smc" class="md-nav__link">
    <span class="md-ellipsis">
      fit_smc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.get_mixture_distribution" class="md-nav__link">
    <span class="md-ellipsis">
      get_mixture_distribution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.get_particles" class="md-nav__link">
    <span class="md-ellipsis">
      get_particles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.get_predictive_distributions" class="md-nav__link">
    <span class="md-ellipsis">
      get_predictive_distributions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.load_state" class="md-nav__link">
    <span class="md-ellipsis">
      load_state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.save_state" class="md-nav__link">
    <span class="md-ellipsis">
      save_state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gallifrey.GPModel.update_state" class="md-nav__link">
    <span class="md-ellipsis">
      update_state
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.LinearSchedule" class="md-nav__link">
    <span class="md-ellipsis">
      LinearSchedule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LinearSchedule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gallifrey.LinearSchedule.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gallifrey.LogSchedule" class="md-nav__link">
    <span class="md-ellipsis">
      LogSchedule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogSchedule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gallifrey.LogSchedule.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>gallifrey</h1>

<div class="doc doc-object doc-module">



<a id="gallifrey"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="gallifrey.GPConfig" class="doc doc-heading">
            <code>GPConfig</code>


</h2>


    <div class="doc doc-contents ">


        <p>Config for the GP model.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPConfig.max_depth">max_depth</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum depth of the kernel tree. By default, 3.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPConfig.atoms">atoms</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="AbstractAtom (gallifrey.kernels.atoms.AbstractAtom)" href="kernels/atoms/#gallifrey.kernels.atoms.AbstractAtom">AbstractAtom</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of atomic kernels to consider in the kernel tree.
By default, the following kernels are included:
- Linear
- Periodic
- RBF</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPConfig.operators">operators</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="AbstractOperator (gallifrey.kernels.atoms.AbstractOperator)" href="kernels/atoms/#gallifrey.kernels.atoms.AbstractOperator">AbstractOperator</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of kernel operators to consider in the kernel tree.
The operators are used to combine the atomic kernels (i.e., functions)
in the kernel structure. By default, the following operators are included:
- SumOperator
- ProductOperator</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPConfig.node_probabilities">node_probabilities</span></code></td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probabilities for sampling the kernels and operators. This array
should have a length equal to the sum of the number of kernels
and operators. The first part of the array should contain the
probabilities for sampling the kernels (in the order of them being listed
in the <code>atoms</code> attribute), and the second part should contain the
probabilities for sampling the operators (in the order of them being listed
in the <code>operators</code> attribute).
By default, the probabilities are set to be equal for all kernels, and
half that probability for the operators (to encourage kernels with
fewer terms)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPConfig.prior_transforms">prior_transforms</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="Transformation">Transformation</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing the bijectors for transforming the kernel parameters
to the prior distribution. Originally, the parameters are sampled from a
standard normal distribution, and these bijectors transform the samples to
the desired prior distribution. The keys are inherited from GPJax, and describe
the domain of the kernel parameters. The values are the bijectors that
transform the standard normal samples to the desired prior distribution. The
bijection transformation should be implemented via TensorFlow Probability
bijectors.
By default, the following bijectors are included:
- "real": Log-normal transform (normal -&gt; log-normal)
- "positive": Log-normal transform (normal -&gt; log-normal)
- "sigmoid": Logit-normal transform (normal -&gt; logit-normal)
NOTE: The "none" key is reserved for internal use and should not be used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPConfig.hmc_config">hmc_config</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for the HMC sampler. The dictionary should contain the following
keys:
- "step_size": The step size of the HMC sampler. By default, 0.02.
- "inv_mass_matrix_scaling": The scaling factor for the inverse mass matrix.
    By default, 1.0.
- "num_integration_steps": The number of integration steps for the HMC sampler.
    By default, 10.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="noise_prior

  
      property
   (gallifrey.GPConfig.noise_prior)" href="#gallifrey.GPConfig.noise_prior">noise_prior</a></code></td>
            <td>
                  <code><span title="tensorflow_probability.substrates.jax.distributions.Distribution">Distribution</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of tensorflow_probability.substrates.jax.distributions.Distribution
that samples the noise variance from the prior distribution. Must have methods
"sample" and "log_prob". The default is an InverseGamma(1,1) distribution.
NOTE: The noise variance prior is currently fixed to the InverseGamma(1,1)
distribution, and cannot be changed. This is because the InverseGamma(1,1)
distribution is needed to caluculate the Monte Carlo acceptance probabilities
analytically. Other distributions are not currently supported.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPConfig.mean_function">mean_function</span></code></td>
            <td>
                  <code><span title="AbstractMeanFunction">AbstractMeanFunction</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mean function of the GP model. By default, a zero mean function is used.
The constant is explicitly set to 0.0, (and is not a ParticleParameter from
the gallifrey.parameter class, so it is not trainable).
NOTE: Non-zero mean functions are not currently implemented, do not change
this attribute.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>gallifrey/gpconfig.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GPConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Config for the GP model.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    max_depth : int</span>
<span class="sd">        Maximum depth of the kernel tree. By default, 3.</span>

<span class="sd">    atoms : list[AbstractAtom]</span>
<span class="sd">        List of atomic kernels to consider in the kernel tree.</span>
<span class="sd">        By default, the following kernels are included:</span>
<span class="sd">        - Linear</span>
<span class="sd">        - Periodic</span>
<span class="sd">        - RBF</span>

<span class="sd">    operators : list[AbstractOperator]</span>
<span class="sd">        List of kernel operators to consider in the kernel tree.</span>
<span class="sd">        The operators are used to combine the atomic kernels (i.e., functions)</span>
<span class="sd">        in the kernel structure. By default, the following operators are included:</span>
<span class="sd">        - SumOperator</span>
<span class="sd">        - ProductOperator</span>

<span class="sd">    node_probabilities :  Float[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        Probabilities for sampling the kernels and operators. This array</span>
<span class="sd">        should have a length equal to the sum of the number of kernels</span>
<span class="sd">        and operators. The first part of the array should contain the</span>
<span class="sd">        probabilities for sampling the kernels (in the order of them being listed</span>
<span class="sd">        in the `atoms` attribute), and the second part should contain the</span>
<span class="sd">        probabilities for sampling the operators (in the order of them being listed</span>
<span class="sd">        in the `operators` attribute).</span>
<span class="sd">        By default, the probabilities are set to be equal for all kernels, and</span>
<span class="sd">        half that probability for the operators (to encourage kernels with</span>
<span class="sd">        fewer terms)</span>

<span class="sd">    prior_transforms : dict[str, Transformation]</span>
<span class="sd">        Dictionary containing the bijectors for transforming the kernel parameters</span>
<span class="sd">        to the prior distribution. Originally, the parameters are sampled from a</span>
<span class="sd">        standard normal distribution, and these bijectors transform the samples to</span>
<span class="sd">        the desired prior distribution. The keys are inherited from GPJax, and describe</span>
<span class="sd">        the domain of the kernel parameters. The values are the bijectors that</span>
<span class="sd">        transform the standard normal samples to the desired prior distribution. The</span>
<span class="sd">        bijection transformation should be implemented via TensorFlow Probability</span>
<span class="sd">        bijectors.</span>
<span class="sd">        By default, the following bijectors are included:</span>
<span class="sd">        - &quot;real&quot;: Log-normal transform (normal -&gt; log-normal)</span>
<span class="sd">        - &quot;positive&quot;: Log-normal transform (normal -&gt; log-normal)</span>
<span class="sd">        - &quot;sigmoid&quot;: Logit-normal transform (normal -&gt; logit-normal)</span>
<span class="sd">        NOTE: The &quot;none&quot; key is reserved for internal use and should not be used.</span>

<span class="sd">    hmc_config : dict[str, float]</span>
<span class="sd">        Configuration for the HMC sampler. The dictionary should contain the following</span>
<span class="sd">        keys:</span>
<span class="sd">        - &quot;step_size&quot;: The step size of the HMC sampler. By default, 0.02.</span>
<span class="sd">        - &quot;inv_mass_matrix_scaling&quot;: The scaling factor for the inverse mass matrix.</span>
<span class="sd">            By default, 1.0.</span>
<span class="sd">        - &quot;num_integration_steps&quot;: The number of integration steps for the HMC sampler.</span>
<span class="sd">            By default, 10.</span>

<span class="sd">    noise_prior : Distribution</span>
<span class="sd">        An instance of tensorflow_probability.substrates.jax.distributions.Distribution</span>
<span class="sd">        that samples the noise variance from the prior distribution. Must have methods</span>
<span class="sd">        &quot;sample&quot; and &quot;log_prob&quot;. The default is an InverseGamma(1,1) distribution.</span>
<span class="sd">        NOTE: The noise variance prior is currently fixed to the InverseGamma(1,1)</span>
<span class="sd">        distribution, and cannot be changed. This is because the InverseGamma(1,1)</span>
<span class="sd">        distribution is needed to caluculate the Monte Carlo acceptance probabilities</span>
<span class="sd">        analytically. Other distributions are not currently supported.</span>

<span class="sd">    mean_function : AbstractMeanFunction</span>
<span class="sd">        The mean function of the GP model. By default, a zero mean function is used.</span>
<span class="sd">        The constant is explicitly set to 0.0, (and is not a ParticleParameter from</span>
<span class="sd">        the gallifrey.parameter class, so it is not trainable).</span>
<span class="sd">        NOTE: Non-zero mean functions are not currently implemented, do not change</span>
<span class="sd">        this attribute.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">atoms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AbstractAtom</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># ConstantAtom(),</span>
            <span class="n">LinearAtom</span><span class="p">(),</span>
            <span class="c1"># LinearWithShiftAtom(),</span>
            <span class="n">PeriodicAtom</span><span class="p">(),</span>
            <span class="c1"># Matern12Atom(),</span>
            <span class="c1"># Matern32Atom(),</span>
            <span class="c1"># Matern52Atom(),</span>
            <span class="n">RBFAtom</span><span class="p">(),</span>
            <span class="c1"># PoweredExponentialAtom(),</span>
            <span class="c1"># RationalQuadraticAtom(),</span>
            <span class="c1"># WhiteAtom(),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">operators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AbstractOperator</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">SumOperator</span><span class="p">(),</span>
            <span class="n">ProductOperator</span><span class="p">(),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">node_probabilities</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="c1"># 1.0,  # Constant</span>
                <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Linear</span>
                <span class="c1"># 1.0, # LinearWithShift</span>
                <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Periodic</span>
                <span class="c1"># 1.0, # Matern12</span>
                <span class="c1"># 1.0, # Matern32</span>
                <span class="c1"># 1.0, # Matern52</span>
                <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># RBF</span>
                <span class="c1"># 1.0, # PoweredExponential</span>
                <span class="c1"># 1.0, # RationalQuadratic</span>
                <span class="c1"># 1.0, # White</span>
                <span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># SumOperator</span>
                <span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># ProductOperator</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">prior_transforms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Bijector</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="c1"># this is the transformation y = exp(mu + sigma * z),</span>
                <span class="c1"># with mu = 0 and sigma = 1,</span>
                <span class="c1"># if z ~ normal(0, 1) then y ~ log-normal(mu, sigma)</span>
                <span class="s2">&quot;real&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Exp</span><span class="p">(),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)),</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Exp</span><span class="p">(),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)),</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="c1"># this is the transformation y = 1/(1 + exp(-(mu + sigma * z))),</span>
                <span class="c1"># with mu = 0 and sigma = 1,</span>
                <span class="c1"># if z ~ normal(0, 1) then y ~ logit-normal(mu, sigma)</span>
                <span class="s2">&quot;sigmoid&quot;</span><span class="p">:</span> <span class="n">tfb</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span>
                            <span class="n">low</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
                            <span class="n">high</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                <span class="mf">0.95</span>  <span class="c1"># slightly below 1 to avoid numerical issues</span>
                            <span class="p">),</span>
                        <span class="p">),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
                        <span class="n">tfb</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)),</span>
                    <span class="p">]</span>
                <span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">hmc_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;step_size&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span>
            <span class="s2">&quot;inv_mass_matrix_scaling&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;num_integration_steps&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">noise_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Distribution</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The distribution of the noise variance prior,</span>
<span class="sd">        specifically an InverseGamma(1,1) distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Distribution</span>
<span class="sd">            The noise variance prior distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">InverseGamma</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="gallifrey.GPConfig.noise_prior" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">noise_prior</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The distribution of the noise variance prior,
specifically an InverseGamma(1,1) distribution.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tensorflow_probability.substrates.jax.distributions.Distribution">Distribution</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The noise variance prior distribution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="gallifrey.GPModel" class="doc doc-heading">
            <code>GPModel</code>


</h2>


    <div class="doc doc-contents ">


        <p>The GP model class.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="num_particles

  
      property
   (gallifrey.GPModel.num_particles)" href="#gallifrey.GPModel.num_particles">num_particles</a></code></td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of particles in the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.config">config</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPConfig (gallifrey.gpconfig.GPConfig)" href="gpconfig/#gallifrey.gpconfig.GPConfig">GPConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The config instance for the GP model (see
gallifrey.config.GPConfig for details).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.kernel_prior">kernel_prior</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="KernelPrior (gallifrey.kernels.prior.KernelPrior)" href="kernels/prior/#gallifrey.kernels.prior.KernelPrior">KernelPrior</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kernel prior object, containing various
useful methods and attributes for the kernel
sampling. Attributes set through config. (See
gallifrey.kernels.prior.KernelPrior for details.)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="noise_prior

  
      property
   (gallifrey.GPModel.noise_prior)" href="#gallifrey.GPModel.noise_prior">noise_prior</a></code></td>
            <td>
                  <code><span title="tensorflow_probability.substrates.jax.distributions.Distribution">Distribution</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prior distribution for the noise variance, inherited
from the config. (See gallifrey.config.GPConfig for details.)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="kernel_library

  
      property
   (gallifrey.GPModel.kernel_library)" href="#gallifrey.GPModel.kernel_library">kernel_library</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="KernelLibrary (gallifrey.kernels.library.KernelLibrary)" href="kernels/library/#gallifrey.kernels.library.KernelLibrary">KernelLibrary</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kernel library, containing the atomic kernels, operators,
and prior transforms. (See gallifrey.kernels.library.KernelLibrary
for details.)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.x">x</span></code></td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input x data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.y">y</span></code></td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input y data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.noise_variance">noise_variance</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial noise variance if fixed, otherwise None.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.fix_noise">fix_noise</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether the noise variance is fixed or learned.
This is set to True if the noise variance is provided
as an input parameter.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.x_transform">x_transform</span></code></td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="Callable">Callable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A (optional) transformation applied to the input x data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.y_transform">y_transform</span></code></td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="Callable">Callable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A (optional) transformation applied to the input y data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.x_transformed">x_transformed</span></code></td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The transformed input x data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.y_transformed">y_transformed</span></code></td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The transformed noise variance if fixed, otherwise None.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.noise_variance_transformed">noise_variance_transformed</span></code></td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="jax.numpy.ndarray">ndarray</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The transformed noise variance, if noise variance is provided.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.dataset">dataset</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Dataset (gallifrey.data.Dataset)" href="data/#gallifrey.data.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataset instance containing the transformed x and y data, processed
for the sampler.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.particle_graphdef">particle_graphdef</span></code></td>
            <td>
                  <code><span title="flax.nnx.GraphDef">GraphDef</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Graph definition for the Particle object, shared across all particles.
This can be used to reconstruct the Particle object from a particle state.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.state">state</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The state of the GP model, containing the particle states and
other relevant information. (See gallifrey.inference.state.GPState
for details.)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="gallifrey.GPModel.hmc_sampler_factory">hmc_sampler_factory</span></code></td>
            <td>
                  <code><span title="Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Factory function to create HMC samplers (using blackjax), configured based on
<code>config.hmc_config</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="update_state(gpstate) (gallifrey.GPModel.update_state)" href="#gallifrey.GPModel.update_state">update_state</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Update the internal gpstate of the model using a new GPState object.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="save_state(path, gpstate=None) (gallifrey.GPModel.save_state)" href="#gallifrey.GPModel.save_state">save_state</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Save a GP state to file. Note that currently only the state is saved
and not the model itself. That means if the model is loaded with a different
configuration (e.g. different kernel library), the state might not be
consistent with the model.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="load_state(path)

  
      classmethod
   (gallifrey.GPModel.load_state)" href="#gallifrey.GPModel.load_state">load_state</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Load a GP state from file. Note that currently only the state is loaded
and not the model itself. That means if the model is loaded with a different
configuration (e.g. different kernel library), the state might not be
consistent with the model.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit_mcmc(key, n_mcmc, n_hmc, verbosity=0) (gallifrey.GPModel.fit_mcmc)" href="#gallifrey.GPModel.fit_mcmc">fit_mcmc</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Fit the GP model using MCMC.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit_smc(key, annealing_schedule, n_mcmc, n_hmc, verbosity=0) (gallifrey.GPModel.fit_smc)" href="#gallifrey.GPModel.fit_smc">fit_smc</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Fit the GP model using SMC.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_particles(gpstate=None) (gallifrey.GPModel.get_particles)" href="#gallifrey.GPModel.get_particles">get_particles</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Get a list of Particle instances from a GP state. If no GP state
is provided, the current GP state of the model is used.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_predictive_distributions(xpredict, data=None, gpstate=None, latent=False) (gallifrey.GPModel.get_predictive_distributions)" href="#gallifrey.GPModel.get_predictive_distributions">get_predictive_distributions</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate the predictive distributions for the individual particles in the
GP state. The distributions are calculated at the points <code>x_predict</code> and
conditioned on the training data (which was supplied to construct the model
instance).</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="get_mixture_distribution(xpredict, gpstate=None, data=None, log_weights=None, num_particles=None, key=None, latent=False) (gallifrey.GPModel.get_mixture_distribution)" href="#gallifrey.GPModel.get_mixture_distribution">get_mixture_distribution</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Get the mixture distribution of an SMC state (A weighted sum of the predictive
distributions of the individual particles). The model should be created using
the <code>fit_smc</code> method.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="display(gpstate=None, num_particles=None) (gallifrey.GPModel.display)" href="#gallifrey.GPModel.display">display</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Print a summary of the GP model, including particle kernels and noise variances.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>gallifrey/model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GPModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The GP model class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    num_particles : ScalarInt</span>
<span class="sd">        Number of particles in the model.</span>
<span class="sd">    config : GPConfig</span>
<span class="sd">        The config instance for the GP model (see</span>
<span class="sd">        gallifrey.config.GPConfig for details).</span>
<span class="sd">    kernel_prior : KernelPrior</span>
<span class="sd">        The kernel prior object, containing various</span>
<span class="sd">        useful methods and attributes for the kernel</span>
<span class="sd">        sampling. Attributes set through config. (See</span>
<span class="sd">        gallifrey.kernels.prior.KernelPrior for details.)</span>
<span class="sd">    noise_prior : Distribution</span>
<span class="sd">        The prior distribution for the noise variance, inherited</span>
<span class="sd">        from the config. (See gallifrey.config.GPConfig for details.)</span>
<span class="sd">    kernel_library : KernelLibrary</span>
<span class="sd">        The kernel library, containing the atomic kernels, operators,</span>
<span class="sd">        and prior transforms. (See gallifrey.kernels.library.KernelLibrary</span>
<span class="sd">        for details.)</span>
<span class="sd">    x :  Float[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The input x data.</span>
<span class="sd">    y :  Float[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The input y data.</span>
<span class="sd">    noise_variance:</span>
<span class="sd">        The initial noise variance if fixed, otherwise None.</span>
<span class="sd">    fix_noise : bool</span>
<span class="sd">        Flag indicating whether the noise variance is fixed or learned.</span>
<span class="sd">        This is set to True if the noise variance is provided</span>
<span class="sd">        as an input parameter.</span>
<span class="sd">    x_transform : Optional[Callable]</span>
<span class="sd">        A (optional) transformation applied to the input x data.</span>
<span class="sd">    y_transform : Optional[Callable]</span>
<span class="sd">        A (optional) transformation applied to the input y data.</span>
<span class="sd">    x_transformed :  Float[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The transformed input x data.</span>
<span class="sd">    y_transformed :  Float[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The transformed noise variance if fixed, otherwise None.</span>
<span class="sd">    noise_variance_transformed :  Float[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">        The transformed noise variance, if noise variance is provided.</span>
<span class="sd">    dataset : Dataset</span>
<span class="sd">        A dataset instance containing the transformed x and y data, processed</span>
<span class="sd">        for the sampler.</span>
<span class="sd">    particle_graphdef : nnx.GraphDef</span>
<span class="sd">        Graph definition for the Particle object, shared across all particles.</span>
<span class="sd">        This can be used to reconstruct the Particle object from a particle state.</span>
<span class="sd">    state : GPState</span>
<span class="sd">        The state of the GP model, containing the particle states and</span>
<span class="sd">        other relevant information. (See gallifrey.inference.state.GPState</span>
<span class="sd">        for details.)</span>
<span class="sd">    hmc_sampler_factory : Callable</span>
<span class="sd">        Factory function to create HMC samplers (using blackjax), configured based on</span>
<span class="sd">        `config.hmc_config`</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    update_state</span>
<span class="sd">        Update the internal gpstate of the model using a new GPState object.</span>
<span class="sd">    save_state</span>
<span class="sd">        Save a GP state to file. Note that currently only the state is saved</span>
<span class="sd">        and not the model itself. That means if the model is loaded with a different</span>
<span class="sd">        configuration (e.g. different kernel library), the state might not be</span>
<span class="sd">        consistent with the model.</span>
<span class="sd">    load_state</span>
<span class="sd">        Load a GP state from file. Note that currently only the state is loaded</span>
<span class="sd">        and not the model itself. That means if the model is loaded with a different</span>
<span class="sd">        configuration (e.g. different kernel library), the state might not be</span>
<span class="sd">        consistent with the model.</span>
<span class="sd">    fit_mcmc</span>
<span class="sd">        Fit the GP model using MCMC.</span>
<span class="sd">    fit_smc</span>
<span class="sd">        Fit the GP model using SMC.</span>
<span class="sd">    get_particles</span>
<span class="sd">        Get a list of Particle instances from a GP state. If no GP state</span>
<span class="sd">        is provided, the current GP state of the model is used.</span>
<span class="sd">    get_predictive_distributions</span>
<span class="sd">        Calculate the predictive distributions for the individual particles in the</span>
<span class="sd">        GP state. The distributions are calculated at the points `x_predict` and</span>
<span class="sd">        conditioned on the training data (which was supplied to construct the model</span>
<span class="sd">        instance).</span>
<span class="sd">    get_mixture_distribution</span>
<span class="sd">        Get the mixture distribution of an SMC state (A weighted sum of the predictive</span>
<span class="sd">        distributions of the individual particles). The model should be created using</span>
<span class="sd">        the `fit_smc` method.</span>
<span class="sd">    display</span>
<span class="sd">        Print a summary of the GP model, including particle kernels and noise variances.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
        <span class="n">num_particles</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
        <span class="n">noise_variance</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ScalarFloat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">x_transform</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">Transform</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearTransform</span><span class="p">,</span>
        <span class="n">y_transform</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">Transform</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearTransform</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the GP model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : PRNGKeyArray</span>
<span class="sd">            The random key for the initial sampling.</span>
<span class="sd">        x : Float[Array, &quot; D&quot;]</span>
<span class="sd">            Input data, array of shape (D,).</span>
<span class="sd">        y : Float[Array, &quot; D&quot;]</span>
<span class="sd">            Target data, array of shape (D,).</span>
<span class="sd">        num_particles : ScalarInt</span>
<span class="sd">            The number of particles in the model.</span>
<span class="sd">        noise_variance : tp.Optional[ScalarFloat], optional</span>
<span class="sd">            The variance of the observation noise. If</span>
<span class="sd">            None, the noise variance is sampled and treated</span>
<span class="sd">            as a trainable parameter. By default None.</span>
<span class="sd">            NOTE: Currently heteroscadastic noise is not</span>
<span class="sd">            supported.</span>
<span class="sd">        x_transform : Transform, optional</span>
<span class="sd">            A transformation applied to the input x data, must</span>
<span class="sd">            be an instance of gallifrey.inference.transforms.Transform</span>
<span class="sd">            class. By default LinearTransform. (Used to normalise</span>
<span class="sd">            data for easier training.)</span>
<span class="sd">        y_transform : Optional[Callable], optional</span>
<span class="sd">            A transformation applied to the input y data, must</span>
<span class="sd">            be an instance of gallifrey.inference.transforms.Transform</span>
<span class="sd">            class. By default LinearTransform. (Used to normalise</span>
<span class="sd">            data for easier training.)</span>
<span class="sd">        config : tp.Optional[GPConfig], optional</span>
<span class="sd">            The configuration object for the GP model. Contains</span>
<span class="sd">            information of the kernel and parameter priors, the</span>
<span class="sd">            mean function, the max depth of the tree kernel, etc.</span>
<span class="sd">            By default None, in which case the default configuration</span>
<span class="sd">            is used (see gallifrey.config.GPConfig for details).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Input data x and y must have the same length, &quot;</span>
                <span class="s2">&quot;but got len(x)={len(x)} and len(y)={len(y)}.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># set basic attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">GPConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">noise_variance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="c1"># create kernel prior</span>
        <span class="n">kernel_library</span> <span class="o">=</span> <span class="n">KernelLibrary</span><span class="p">(</span>
            <span class="n">atoms</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">atoms</span><span class="p">),</span>
            <span class="n">operators</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">operators</span><span class="p">),</span>
            <span class="n">prior_transforms</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">prior_transforms</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span> <span class="o">=</span> <span class="n">KernelPrior</span><span class="p">(</span>
            <span class="n">kernel_library</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_depth</span><span class="p">),</span>
            <span class="n">num_datapoints</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">probs</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">node_probabilities</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># preprocess data (apply transformations, and set attributes)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="p">,</span>
            <span class="n">x_transform</span><span class="p">,</span>
            <span class="n">y_transform</span><span class="p">,</span>
            <span class="n">noise_variance</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># create a particle_graphdef attributes (using a randomly</span>
        <span class="c1"># initilized particle state). The graphdef attribute,</span>
        <span class="c1"># is used to create particle instances from the particle states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle_graphdef</span><span class="p">,</span> <span class="n">particle_state</span> <span class="o">=</span> <span class="n">initialize_particle_state</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">jr</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_noise_variance</span><span class="p">(</span><span class="n">jr</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># sample initial particles and create initial GP state</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">particle_key</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_state</span><span class="p">(</span><span class="n">particle_key</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">)</span>

        <span class="c1"># create HMC sampler factory for rejuvenation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hmc_sampler_factory</span> <span class="o">=</span> <span class="n">create_hmc_sampler_factory</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">hmc_config</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="o">.</span><span class="n">max_kernel_parameter</span> <span class="o">+</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span><span class="p">)),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_preprocess_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
        <span class="n">x_transform</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">Transform</span><span class="p">],</span>
        <span class="n">y_transform</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">Transform</span><span class="p">],</span>
        <span class="n">noise_variance</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ScalarFloat</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocesses the input data by applying transformations</span>
<span class="sd">        and creating a Dataset object.</span>

<span class="sd">        Applies the specified transformations (`x_transform` and `y_transform`)</span>
<span class="sd">        to the input data `x` and `y`. If a fixed `noise_variance` is provided,</span>
<span class="sd">        it is also transformed using `y_transform`.</span>
<span class="sd">        Finally, it creates a `Dataset` object with the transformed</span>
<span class="sd">        data, which is used for GPJax computations.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x :  Float[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">            The input x data.</span>
<span class="sd">        y :  Float[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">            The input y data.</span>
<span class="sd">        x_transform : tp.Type[Transform]</span>
<span class="sd">            A transformation applied to the input x data.</span>
<span class="sd">        y_transform : tp.Type[Transform]</span>
<span class="sd">            A transformation applied to the input y data.</span>
<span class="sd">        noise_variance : tp.Optional[ScalarFloat]</span>
<span class="sd">            The variance of the observation noise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># create transformation from data and apply to x and y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_transform</span> <span class="o">=</span> <span class="n">x_transform</span><span class="o">.</span><span class="n">from_data_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_transform</span> <span class="o">=</span> <span class="n">y_transform</span><span class="o">.</span><span class="n">from_data_width</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_transform</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_transform</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># transform noise variance if provided</span>
        <span class="k">if</span> <span class="n">noise_variance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noise_variance</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">noise_variance</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noise_variance_transformed</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_transform</span><span class="o">.</span><span class="n">apply_var</span><span class="p">(</span><span class="n">noise_variance</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noise_variance</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noise_variance_transformed</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ensure that x_transformed and y_transformed are still 1D arrays and of</span>
        <span class="c1"># the same length</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;x_transformed and y_transformed must be 1D arrays. &quot;</span>
                <span class="s2">&quot;Please check the transformation functions.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;x_transformed and y_transformed must have the same length.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sample_noise_variance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarFloat</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample the noise variance from the prior distribution, if no</span>
<span class="sd">        noise variance is provided. If a noise variance is provided, it</span>
<span class="sd">        is returned as is.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : PRNGKeyArray</span>
<span class="sd">            Random key for sampling.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">         Float[jnp.ndarray, &quot; D&quot;]</span>
<span class="sd">            The sampled noise variance, one for each particle. (If noise_variance</span>
<span class="sd">            is provided, the same value is returned for all particles.)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_variance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">noise_key</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">variance</span><span class="p">:</span> <span class="n">ScalarFloat</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">noise_prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                    <span class="n">seed</span><span class="o">=</span><span class="n">noise_key</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_variance_transformed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_variance_transformed</span>
        <span class="k">return</span> <span class="n">variance</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
        <span class="n">num_particles</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the state of the GP model. This primarily</span>
<span class="sd">        entails creating the initial particle states by sampling</span>
<span class="sd">        the kernel and noise variance (if not fixed).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : PRNGKeyArray</span>
<span class="sd">            Random key for sampling.</span>
<span class="sd">        num_particles : ScalarInt</span>
<span class="sd">            Number of particles in the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GPState</span>
<span class="sd">            A GPState object representing the state of the GP model (see</span>
<span class="sd">            gallifrey.inference.state.GPState for details).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">make_particle_state</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Create partice by sampling the kernel and noise variance</span>
<span class="sd">            (if not fixed), and initializing the particle state.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">kernel_key</span><span class="p">,</span> <span class="n">variance_key</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">kernel_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">kernel_key</span><span class="p">)</span>
            <span class="n">noise_variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_noise_variance</span><span class="p">(</span><span class="n">variance_key</span><span class="p">)</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">particle_state</span> <span class="o">=</span> <span class="n">initialize_particle_state</span><span class="p">(</span>
                <span class="n">kernel_state</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="p">,</span>
                <span class="n">noise_variance</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">particle_state</span>

        <span class="c1"># create particle states by looping over the number of particles,</span>
        <span class="c1"># and batch into a single state object</span>
        <span class="n">num_particles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_particles</span><span class="p">)</span>
        <span class="n">particle_states</span> <span class="o">=</span> <span class="n">batch_states</span><span class="p">(</span>
            <span class="p">[</span><span class="n">make_particle_state</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">GPState</span><span class="p">(</span>
            <span class="n">particle_states</span><span class="o">=</span><span class="n">particle_states</span><span class="p">,</span>
            <span class="n">num_particles</span><span class="o">=</span><span class="n">num_particles</span><span class="p">,</span>
            <span class="n">num_data_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
            <span class="n">mcmc_accepted</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_particles</span><span class="p">),</span>
            <span class="n">hmc_accepted</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_particles</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string representation of the GPModel.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A string representation of the GPModel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;GPModel(num_particles=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">kernel_library</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KernelLibrary</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the kernel library.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        KernelLibrary</span>
<span class="sd">            The kernel library.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="o">.</span><span class="n">kernel_library</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">noise_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Distribution</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the noise prior distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        InverseGamma</span>
<span class="sd">            The noise prior distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">noise_prior</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarInt</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of particles in the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ScalarInt</span>
<span class="sd">            The number of particles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">num_particles</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gpstate</span><span class="p">:</span> <span class="n">GPState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GPModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the GP state. Returns a new GPModel instance (no in-place</span>
<span class="sd">        update). If the number of particles in the new state is different</span>
<span class="sd">        from the current state, the num_particles attribute is updated.</span>

<span class="sd">        Note that no other attributes are updated. If the particle states</span>
<span class="sd">        were created using a different configuration, the model will not be</span>
<span class="sd">        consistent.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gpstate : GPState</span>
<span class="sd">            The new GP state to update the model with.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GPModel</span>
<span class="sd">            A new GPModel instance with updated state.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_gpmodel</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_gpmodel</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">gpstate</span>

        <span class="k">return</span> <span class="n">new_gpmodel</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PosixPath</span><span class="p">,</span>
        <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save a GP state to file.</span>

<span class="sd">        Note that only the state is saved and not the model itself.</span>
<span class="sd">        That means if the model is loaded with a different configuration</span>
<span class="sd">        (e.g. different kernel library), the state might not be consistent</span>
<span class="sd">        with the model.</span>

<span class="sd">        TODO: Implement saving the model configuration as well.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str | PosixPath</span>
<span class="sd">            The path where to save the GP state, must</span>
<span class="sd">            be an absolute path.</span>
<span class="sd">        gpstate : tp.Optional[GPState], optional</span>
<span class="sd">            The GP state to save, If None, the current state</span>
<span class="sd">            of the model is used. By default None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gpstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">gpstate</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_state</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PosixPath</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GPState</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a GP state from file.</span>

<span class="sd">        Note that only the state is loaded. It is assumed that the model</span>
<span class="sd">        configuration is consistent with how the state was saved. If the</span>
<span class="sd">        model configuration is different, the loaded state might not be</span>
<span class="sd">        consistent with the model.</span>

<span class="sd">        The model does not get update with the loaded state. To update the</span>
<span class="sd">        model, use the `update_gpstate` method with the loaded state.</span>

<span class="sd">        TODO: Implement loading the model configuration as well.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str | PosixPath</span>
<span class="sd">            The path where to load the GP state from.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GPState</span>
<span class="sd">            An instance of the GPState object, containing the loaded state.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">gpstate</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gpstate</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit_mcmc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
        <span class="n">n_mcmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
        <span class="n">n_hmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="p">:</span> <span class="n">ScalarInt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">GPState</span><span class="p">,</span> <span class="n">GPState</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the GP model using MCMC.</span>
<span class="sd">        It perfoms n_mcmc iterations of the structure, and for each</span>
<span class="sd">        accepted structure move performs n_hmc iterations of the HMC</span>
<span class="sd">        sampler over the parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : PRNGKeyArray</span>
<span class="sd">            Random key for MCMC sampling.</span>
<span class="sd">        n_mcmc : ScalarInt</span>
<span class="sd">            Number of MCMC iterations over kernel structure.</span>
<span class="sd">        n_hmc : ScalarInt</span>
<span class="sd">            Number of HMC steps for continuous parameters. Only used if</span>
<span class="sd">            the structure move is accepted.</span>
<span class="sd">        verbosity : ScalarInt, optional</span>
<span class="sd">            The verbosity level, by default 0. Debugging information</span>
<span class="sd">            is printed if `verbosity &gt; 1`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GPState</span>
<span class="sd">            The final state of the model, wrapped in an GPState object (see</span>
<span class="sd">            gallifrey.inference.state.GPState for details).</span>
<span class="sd">        GPState</span>
<span class="sd">            The history over all MCMC iterations, wrapped in an GPState object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_mcmc</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected `n_mcmc` to be an integer, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">n_mcmc</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_hmc</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected `n_hmc` to be an integer, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">n_hmc</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">n_mcmc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected `n_mcmc` to be a positive integer, but got </span><span class="si">{</span><span class="n">n_mcmc</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">n_hmc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected `n_hmc` to be a positive integer, but got </span><span class="si">{</span><span class="n">n_hmc</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
            <span class="n">state</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">ScalarInt</span><span class="p">,</span> <span class="n">ScalarInt</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Wrapper around the rejuvenate_particle function using</span>
<span class="sd">            GPmodel attributes.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">rejuvenate_particle</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">state</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">noise_prior</span><span class="p">,</span>
                <span class="n">n_mcmc</span><span class="o">=</span><span class="n">n_mcmc</span><span class="p">,</span>
                <span class="n">n_hmc</span><span class="o">=</span><span class="n">n_hmc</span><span class="p">,</span>
                <span class="n">fix_noise</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span><span class="p">,</span>
                <span class="n">hmc_sampler_factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmc_sampler_factory</span><span class="p">,</span>
                <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">final_state</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">accepted_mcmc</span><span class="p">,</span> <span class="n">accepted_hmc</span> <span class="o">=</span> <span class="n">pmap</span><span class="p">(</span>
            <span class="n">jit</span><span class="p">(</span><span class="n">wrapper</span><span class="p">),</span> <span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)(</span>
            <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">)),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">particle_states</span><span class="p">,</span>  <span class="c1"># use states batched over 0th axis</span>
        <span class="p">)</span>

        <span class="c1"># print information</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">acc_mcmc</span><span class="p">,</span> <span class="n">acc_hmc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">),</span> <span class="n">accepted_mcmc</span><span class="p">,</span> <span class="n">accepted_hmc</span>
            <span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Particle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> | Accepted: MCMC[</span><span class="si">{</span><span class="n">acc_mcmc</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_mcmc</span><span class="si">}</span><span class="s2">] &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; HMC[</span><span class="si">{</span><span class="n">acc_hmc</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">acc_mcmc</span><span class="o">*</span><span class="n">n_hmc</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="p">)</span>

        <span class="c1"># wrap final state and history in GPState objects, for consistency</span>
        <span class="c1"># with the SMC algorithm</span>
        <span class="n">final_state_wrapped</span> <span class="o">=</span> <span class="n">GPState</span><span class="p">(</span>
            <span class="n">particle_states</span><span class="o">=</span><span class="n">final_state</span><span class="p">,</span>
            <span class="n">num_particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">,</span>
            <span class="n">num_data_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
            <span class="n">mcmc_accepted</span><span class="o">=</span><span class="n">accepted_mcmc</span><span class="p">,</span>
            <span class="n">hmc_accepted</span><span class="o">=</span><span class="n">accepted_hmc</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">history_wrapped</span> <span class="o">=</span> <span class="n">GPState</span><span class="p">(</span>
            <span class="n">particle_states</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
            <span class="n">num_particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">,</span>
            <span class="n">num_data_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
            <span class="n">mcmc_accepted</span><span class="o">=</span><span class="n">accepted_mcmc</span><span class="p">,</span>
            <span class="n">hmc_accepted</span><span class="o">=</span><span class="n">accepted_hmc</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">final_state_wrapped</span><span class="p">,</span> <span class="n">history_wrapped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit_smc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
        <span class="n">annealing_schedule</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">n_mcmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
        <span class="n">n_hmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">GPState</span><span class="p">,</span> <span class="n">GPState</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the GP model using SMC.</span>

<span class="sd">        For a detailed description of the SMC algorithm, see the</span>
<span class="sd">        &#39;gallofrey.inference.smc.smc_loop&#39; function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : PRNGKeyArray</span>
<span class="sd">            The random key for the SMC sampling.</span>
<span class="sd">        annealing_schedule : tuple[int, ...]</span>
<span class="sd">            The data annealing schedule for the SMC algorithm,</span>
<span class="sd">            number of data points to consider at each step.</span>
<span class="sd">            NOTE: Must be given in form of a tuple of integers, for</span>
<span class="sd">            jax compatibility. Easily generated using the `generate`</span>
<span class="sd">            method of the `Schedule` in `gallifrey.schedule`.</span>
<span class="sd">        n_mcmc : ScalarInt</span>
<span class="sd">            Number of MCMC iterations over kernel structure per</span>
<span class="sd">            SMC step.</span>
<span class="sd">        n_hmc : ScalarInt</span>
<span class="sd">            Number of HMC steps for continuous parameters per</span>
<span class="sd">            SMC step. Only used if the structure move is accepted.</span>
<span class="sd">        verbosity : int, optional</span>
<span class="sd">            The verbosity level, by default 0. Debugging information</span>
<span class="sd">            is printed if `verbosity &gt; 1`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GPState</span>
<span class="sd">            The final SMC state. Contains the final particle states</span>
<span class="sd">            and the final weights (among other things, see</span>
<span class="sd">            &#39;gallifrey.inference.state.GPState&#39; for details).</span>
<span class="sd">        GPState</span>
<span class="sd">            The history of the SMC algorithm. Contains the particle</span>
<span class="sd">            states and weights at each step of the algorithm.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">final_smc_state</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">smc_loop</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">particle_states</span><span class="p">,</span>
            <span class="n">annealing_schedule</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noise_prior</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hmc_sampler_factory</span><span class="p">,</span>
            <span class="n">n_mcmc</span><span class="p">,</span>
            <span class="n">n_hmc</span><span class="p">,</span>
            <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">batched_history</span><span class="p">:</span> <span class="n">GPState</span> <span class="o">=</span> <span class="n">batch_states</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">final_smc_state</span><span class="p">,</span> <span class="n">batched_history</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_particles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Particle</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of Particle instances from a GP state.</span>

<span class="sd">        If no state is provided, the current state of the model</span>
<span class="sd">        is used.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gpstate : tp.Optional[GPState], optional</span>
<span class="sd">            The GP state to extract the particles from. If None,</span>
<span class="sd">            the current state of the model is used. By default None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[Particle]</span>
<span class="sd">            A list of Particle instances, corresponding to the</span>
<span class="sd">            individual states.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gpstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>

        <span class="n">unbatched_particle_states</span> <span class="o">=</span> <span class="n">unbatch_states</span><span class="p">(</span><span class="n">gpstate</span><span class="o">.</span><span class="n">particle_states</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">nnx</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particle_graphdef</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">unbatched_particle_states</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_predictive_distributions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">xpredict</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">latent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Distribution</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the predictive distributions for the individual particles</span>
<span class="sd">        in the GP state. The distributions are calculated at the points</span>
<span class="sd">        `x_predict` and conditioned on the training data (which was supplied</span>
<span class="sd">        to construct the model instance).</span>

<span class="sd">        The distributions are returned as a list of tensorflow probability</span>
<span class="sd">        distribution objects, see</span>
<span class="sd">        https://www.tensorflow.org/probability/api_docs/python/tfp/distributions/MultivariateNormalFullCovariance</span>

<span class="sd">        If no state is provided, the current state of the model</span>
<span class="sd">        is used.</span>

<span class="sd">        If `latent` is True, the predictive distribution is that of the latent</span>
<span class="sd">        function, i.e. the distribution of the function values without the</span>
<span class="sd">        observational noise. If False, the predictive distribution of the full</span>
<span class="sd">        data-generating model is returned, which includes the observational noise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xpredict : Float[Array, &quot; D&quot;]</span>
<span class="sd">            The points to predict, as a 1D array.</span>
<span class="sd">        data : tp.Optional[Dataset], optional</span>
<span class="sd">            The data to condition the predictive distribution on. If None,</span>
<span class="sd">            the training data of the model is used. By default None.</span>
<span class="sd">        gpstate : tp.Optional[GPState], optional</span>
<span class="sd">            The GP state object, containing the particle states. If None,</span>
<span class="sd">            the current state of the model is used. By default None.</span>
<span class="sd">        latent : bool, optional</span>
<span class="sd">            Whether to return the predictive distribution of the latent</span>
<span class="sd">            functions only (without observational noise), by default</span>
<span class="sd">            False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[Distribution]</span>
<span class="sd">            A list of tensorflow probability distribution objects</span>
<span class="sd">            representing the predictive distributions of the Gaussian</span>
<span class="sd">            processes. (Specifically, a MultivariateNormalFullCovariance</span>
<span class="sd">            distribution from `tensorflow_probability.substrates.jax.distributions`).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gpstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">gpstate</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span>

        <span class="n">particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_particles</span><span class="p">(</span><span class="n">gpstate</span><span class="p">)</span>
        <span class="n">distributions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">particle</span><span class="o">.</span><span class="n">predictive_distribution</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">xpredict</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">latent</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="n">particles</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">distributions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_mixture_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">xpredict</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
        <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">log_weights</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; N&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_particles</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ScalarInt</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">PRNGKeyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">latent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Distribution</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the mixture distribution of an SMC state.</span>

<span class="sd">        The predictive distributions for an SMC ensemble are</span>
<span class="sd">        the individual predictive (Gaussion) distributions of the</span>
<span class="sd">        particles, weighted by the particle weights. The resulting</span>
<span class="sd">        distribution is a Gaussian mixture model, implemented as</span>
<span class="sd">        a `MixtureSameFamily` distribution from `tensorflow_probability`, see</span>
<span class="sd">        https://www.tensorflow.org/probability/api_docs/python/tfp/distributions/MixtureSameFamily</span>

<span class="sd">        The mixture distribution is calculated at the points `xpredict`</span>
<span class="sd">        and conditioned on the training data (which was supplied to construct</span>
<span class="sd">        the model instance).</span>

<span class="sd">        The input should be an GPState object as returned by the `fit_smc` method.</span>
<span class="sd">        Alternatively, the log weights can be provided explicitly using the</span>
<span class="sd">        `log_weights` argument.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xpredict : Float[Array, &quot; D&quot;]</span>
<span class="sd">            The points to predict, as a 1D array.</span>
<span class="sd">        gpstate : tp.Optional[GPState], optional</span>
<span class="sd">            The GP state object, containing the particle states and log weights for</span>
<span class="sd">            the mixture distribution. If None, the current state of the model is used.</span>
<span class="sd">            By default None.</span>
<span class="sd">        data : tp.Optional[Dataset], optional</span>
<span class="sd">            The data to condition the predictive distribution on. If None,</span>
<span class="sd">            the training data of the model is used. By default None.</span>
<span class="sd">        log_weights : Float[Array, &quot; N&quot;], optional</span>
<span class="sd">            The log weights of the particles. If None, the log weights from the</span>
<span class="sd">            GP state are used. An error is raised if the log weights are not provided</span>
<span class="sd">            and the GP state does not contain log weights. By default None.</span>
<span class="sd">        num_particles : tp.Optional[ScalarInt], optional</span>
<span class="sd">            Number of particles to include in the mixture distribution. If None,</span>
<span class="sd">            all particles in the state are included. If provided, a random sample</span>
<span class="sd">            of particles is chosen based on the weights. By default None.</span>
<span class="sd">        key : tp.Optional[PRNGKeyArray], optional</span>
<span class="sd">            Random key for sampling the particles. Required if `num_particles` is</span>
<span class="sd">            provided. By default None.</span>
<span class="sd">        latent : bool, optional</span>
<span class="sd">            Whether to return the predictive distribution of the latent</span>
<span class="sd">            functions only (without observational noise), by default</span>
<span class="sd">            False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Distribution</span>
<span class="sd">            A tensorflow probability distribution object representing</span>
<span class="sd">            the Gaussian mixture distribution of the Gaussian processes</span>
<span class="sd">            (a MixtureSameFamily distribution).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the GPState object contains no log weights and `log_weights` is None.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of particles and log weights are inconsistent.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gpstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">gpstate</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">gpstate</span><span class="o">.</span><span class="n">log_weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">log_weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The GPState object contains no log weights. This might be &quot;</span>
                <span class="s2">&quot;because the state was produced with the MCMC sampler or the &quot;</span>
                <span class="s2">&quot;initial state of the GPModel was used. Please either run &quot;</span>
                <span class="s2">&quot;`fit_smc` or provide the log weights explicitly. (Note: If &quot;</span>
                <span class="s2">&quot;you already ran `fit_smc` and this error occurs, make sure to &quot;</span>
                <span class="s2">&quot;passed the the output of `fit_smc` to this method, or run the &quot;</span>
                <span class="s2">&quot;`update_state` method with the output of `fit_smc` as input.)&quot;</span>
            <span class="p">)</span>

        <span class="n">log_weights</span> <span class="o">=</span> <span class="n">log_weights</span> <span class="k">if</span> <span class="n">log_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">gpstate</span><span class="o">.</span><span class="n">log_weights</span>

        <span class="k">assert</span> <span class="n">log_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_weights</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Inconsistent number of particles and log weights, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="si">}</span><span class="s2"> but got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">log_weights</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">individual_distributions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictive_distributions</span><span class="p">(</span>
            <span class="n">xpredict</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">gpstate</span><span class="p">,</span>
            <span class="n">latent</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">num_particles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;If `num_particles` is provided, `key` must also be provided. &quot;</span>
                    <span class="s2">&quot;This is the random key for sampling from the particles.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">num_particles</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Number of particles to sample (</span><span class="si">{</span><span class="n">num_particles</span><span class="si">}</span><span class="s2">) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;exceeds the total number of particles (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>
            <span class="c1"># choose random sample of particles based on weights</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_weights</span><span class="p">)</span>
            <span class="n">particle_indices</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)),</span>
                <span class="n">p</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_particles</span><span class="p">),),</span>
                <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># normalize weights</span>
            <span class="n">log_weights</span> <span class="o">=</span> <span class="n">log_weights</span><span class="p">[</span><span class="n">particle_indices</span><span class="p">]</span> <span class="o">-</span> <span class="n">logsumexp</span><span class="p">(</span>
                <span class="n">log_weights</span><span class="p">[</span><span class="n">particle_indices</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># select particles</span>
            <span class="n">individual_distributions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">individual_distributions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">particle_indices</span>
            <span class="p">]</span>

        <span class="n">batched_distributions</span> <span class="o">=</span> <span class="n">batch_states</span><span class="p">(</span><span class="n">individual_distributions</span><span class="p">)</span>

        <span class="n">mixture_model</span> <span class="o">=</span> <span class="n">MixtureSameFamily</span><span class="p">(</span>
            <span class="n">mixture_distribution</span><span class="o">=</span><span class="n">Categorical</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">log_weights</span><span class="p">),</span>
            <span class="n">components_distribution</span><span class="o">=</span><span class="n">batched_distributions</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">mixture_model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_particles</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ScalarInt</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints a summary of the GP model, including particle kernels</span>
<span class="sd">        and noise variances.</span>

<span class="sd">        If no particle states are provided, the current batched state of the model</span>
<span class="sd">        is used.</span>

<span class="sd">        Iterates through each particle, merges its graph definition and</span>
<span class="sd">        state, and prints the particle index, noise variance, and the kernel structure.</span>
<span class="sd">        Useful for inspecting the current state of the particle ensemble.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gpstate : tp.Optional[GPState], optional</span>
<span class="sd">            The GP state object, containing the particle states. If None, the current</span>
<span class="sd">            state of the model is used. By default None.</span>
<span class="sd">        num_particles : tp.Optional[ScalarInt], optional</span>
<span class="sd">            Number of particles to display. If None, all particles are displayed.</span>
<span class="sd">            By default None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gpstate</span> <span class="o">=</span> <span class="n">gpstate</span> <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="n">num_particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span> <span class="k">if</span> <span class="n">num_particles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">num_particles</span>

        <span class="n">particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_particles</span><span class="p">(</span><span class="n">gpstate</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_particles</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gpstate</span><span class="o">.</span><span class="n">log_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Particle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;| Weight: </span><span class="si">{</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gpstate</span><span class="o">.</span><span class="n">log_weights</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;| Variance: </span><span class="si">{</span><span class="n">particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">noise_variance</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Particle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;| Variance: </span><span class="si">{</span><span class="n">particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">noise_variance</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">kernel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="gallifrey.GPModel.kernel_library" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kernel_library</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the kernel library.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="KernelLibrary (gallifrey.kernels.library.KernelLibrary)" href="kernels/library/#gallifrey.kernels.library.KernelLibrary">KernelLibrary</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kernel library.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="gallifrey.GPModel.noise_prior" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">noise_prior</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the noise prior distribution.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tensorflow_probability.substrates.jax.distributions.InverseGamma">InverseGamma</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The noise prior distribution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="gallifrey.GPModel.num_particles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_particles</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the number of particles in the model.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of particles.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">,</span> <span class="n">noise_variance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_transform</span><span class="o">=</span><span class="n">LinearTransform</span><span class="p">,</span> <span class="n">y_transform</span><span class="o">=</span><span class="n">LinearTransform</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the GP model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="jaxtyping.PRNGKeyArray">PRNGKeyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The random key for the initial sampling.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="gallifrey.utils.typing.Array">Array</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data, array of shape (D,).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="gallifrey.utils.typing.Array">Array</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target data, array of shape (D,).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_particles</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of particles in the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>noise_variance</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="gallifrey.utils.typing.ScalarFloat">ScalarFloat</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The variance of the observation noise. If
None, the noise variance is sampled and treated
as a trainable parameter. By default None.
NOTE: Currently heteroscadastic noise is not
supported.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x_transform</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Transform (gallifrey.inference.transforms.Transform)" href="inference/transforms/#gallifrey.inference.transforms.Transform">Transform</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A transformation applied to the input x data, must
be an instance of gallifrey.inference.transforms.Transform
class. By default LinearTransform. (Used to normalise
data for easier training.)</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="LinearTransform (gallifrey.inference.transforms.LinearTransform)" href="inference/transforms/#gallifrey.inference.transforms.LinearTransform">LinearTransform</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_transform</code>
            </td>
            <td>
                  <code><span title="Optional">Optional</span>[<span title="Callable">Callable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A transformation applied to the input y data, must
be an instance of gallifrey.inference.transforms.Transform
class. By default LinearTransform. (Used to normalise
data for easier training.)</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="LinearTransform (gallifrey.inference.transforms.LinearTransform)" href="inference/transforms/#gallifrey.inference.transforms.LinearTransform">LinearTransform</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="GPConfig (gallifrey.gpconfig.GPConfig)" href="gpconfig/#gallifrey.gpconfig.GPConfig">GPConfig</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration object for the GP model. Contains
information of the kernel and parameter priors, the
mean function, the max depth of the tree kernel, etc.
By default None, in which case the default configuration
is used (see gallifrey.config.GPConfig for details).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
    <span class="n">num_particles</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">noise_variance</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ScalarFloat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">x_transform</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">Transform</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearTransform</span><span class="p">,</span>
    <span class="n">y_transform</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">Transform</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearTransform</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the GP model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : PRNGKeyArray</span>
<span class="sd">        The random key for the initial sampling.</span>
<span class="sd">    x : Float[Array, &quot; D&quot;]</span>
<span class="sd">        Input data, array of shape (D,).</span>
<span class="sd">    y : Float[Array, &quot; D&quot;]</span>
<span class="sd">        Target data, array of shape (D,).</span>
<span class="sd">    num_particles : ScalarInt</span>
<span class="sd">        The number of particles in the model.</span>
<span class="sd">    noise_variance : tp.Optional[ScalarFloat], optional</span>
<span class="sd">        The variance of the observation noise. If</span>
<span class="sd">        None, the noise variance is sampled and treated</span>
<span class="sd">        as a trainable parameter. By default None.</span>
<span class="sd">        NOTE: Currently heteroscadastic noise is not</span>
<span class="sd">        supported.</span>
<span class="sd">    x_transform : Transform, optional</span>
<span class="sd">        A transformation applied to the input x data, must</span>
<span class="sd">        be an instance of gallifrey.inference.transforms.Transform</span>
<span class="sd">        class. By default LinearTransform. (Used to normalise</span>
<span class="sd">        data for easier training.)</span>
<span class="sd">    y_transform : Optional[Callable], optional</span>
<span class="sd">        A transformation applied to the input y data, must</span>
<span class="sd">        be an instance of gallifrey.inference.transforms.Transform</span>
<span class="sd">        class. By default LinearTransform. (Used to normalise</span>
<span class="sd">        data for easier training.)</span>
<span class="sd">    config : tp.Optional[GPConfig], optional</span>
<span class="sd">        The configuration object for the GP model. Contains</span>
<span class="sd">        information of the kernel and parameter priors, the</span>
<span class="sd">        mean function, the max depth of the tree kernel, etc.</span>
<span class="sd">        By default None, in which case the default configuration</span>
<span class="sd">        is used (see gallifrey.config.GPConfig for details).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Input data x and y must have the same length, &quot;</span>
            <span class="s2">&quot;but got len(x)={len(x)} and len(y)={len(y)}.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># set basic attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">GPConfig</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">noise_variance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="c1"># create kernel prior</span>
    <span class="n">kernel_library</span> <span class="o">=</span> <span class="n">KernelLibrary</span><span class="p">(</span>
        <span class="n">atoms</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">atoms</span><span class="p">),</span>
        <span class="n">operators</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">operators</span><span class="p">),</span>
        <span class="n">prior_transforms</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">prior_transforms</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span> <span class="o">=</span> <span class="n">KernelPrior</span><span class="p">(</span>
        <span class="n">kernel_library</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_depth</span><span class="p">),</span>
        <span class="n">num_datapoints</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">probs</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">node_probabilities</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># preprocess data (apply transformations, and set attributes)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">x_transform</span><span class="p">,</span>
        <span class="n">y_transform</span><span class="p">,</span>
        <span class="n">noise_variance</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># create a particle_graphdef attributes (using a randomly</span>
    <span class="c1"># initilized particle state). The graphdef attribute,</span>
    <span class="c1"># is used to create particle instances from the particle states</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">particle_graphdef</span><span class="p">,</span> <span class="n">particle_state</span> <span class="o">=</span> <span class="n">initialize_particle_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">jr</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_noise_variance</span><span class="p">(</span><span class="n">jr</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># sample initial particles and create initial GP state</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">particle_key</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_state</span><span class="p">(</span><span class="n">particle_key</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">)</span>

    <span class="c1"># create HMC sampler factory for rejuvenation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hmc_sampler_factory</span> <span class="o">=</span> <span class="n">create_hmc_sampler_factory</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">hmc_config</span><span class="p">,</span>
        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="o">.</span><span class="n">max_kernel_parameter</span> <span class="o">+</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span><span class="p">)),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a string representation of the GPModel.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string representation of the GPModel.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a string representation of the GPModel.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string representation of the GPModel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;GPModel(num_particles=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.display" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display</span><span class="p">(</span><span class="n">gpstate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_particles</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Prints a summary of the GP model, including particle kernels
and noise variances.</p>
<p>If no particle states are provided, the current batched state of the model
is used.</p>
<p>Iterates through each particle, merges its graph definition and
state, and prints the particle index, noise variance, and the kernel structure.
Useful for inspecting the current state of the particle ensemble.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gpstate</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GP state object, containing the particle states. If None, the current
state of the model is used. By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_particles</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of particles to display. If None, all particles are displayed.
By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_particles</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ScalarInt</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints a summary of the GP model, including particle kernels</span>
<span class="sd">    and noise variances.</span>

<span class="sd">    If no particle states are provided, the current batched state of the model</span>
<span class="sd">    is used.</span>

<span class="sd">    Iterates through each particle, merges its graph definition and</span>
<span class="sd">    state, and prints the particle index, noise variance, and the kernel structure.</span>
<span class="sd">    Useful for inspecting the current state of the particle ensemble.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gpstate : tp.Optional[GPState], optional</span>
<span class="sd">        The GP state object, containing the particle states. If None, the current</span>
<span class="sd">        state of the model is used. By default None.</span>
<span class="sd">    num_particles : tp.Optional[ScalarInt], optional</span>
<span class="sd">        Number of particles to display. If None, all particles are displayed.</span>
<span class="sd">        By default None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gpstate</span> <span class="o">=</span> <span class="n">gpstate</span> <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
    <span class="n">num_particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span> <span class="k">if</span> <span class="n">num_particles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">num_particles</span>

    <span class="n">particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_particles</span><span class="p">(</span><span class="n">gpstate</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_particles</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gpstate</span><span class="o">.</span><span class="n">log_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Particle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;| Weight: </span><span class="si">{</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gpstate</span><span class="o">.</span><span class="n">log_weights</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;| Variance: </span><span class="si">{</span><span class="n">particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">noise_variance</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Particle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;| Variance: </span><span class="si">{</span><span class="n">particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">noise_variance</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">kernel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.fit_mcmc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit_mcmc</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">n_mcmc</span><span class="p">,</span> <span class="n">n_hmc</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fits the GP model using MCMC.
It perfoms n_mcmc iterations of the structure, and for each
accepted structure move performs n_hmc iterations of the HMC
sampler over the parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="jaxtyping.PRNGKeyArray">PRNGKeyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random key for MCMC sampling.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_mcmc</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of MCMC iterations over kernel structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_hmc</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of HMC steps for continuous parameters. Only used if
the structure move is accepted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbosity</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The verbosity level, by default 0. Debugging information
is printed if <code>verbosity &gt; 1</code>.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The final state of the model, wrapped in an GPState object (see
gallifrey.inference.state.GPState for details).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The history over all MCMC iterations, wrapped in an GPState object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit_mcmc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
    <span class="n">n_mcmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">n_hmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="p">:</span> <span class="n">ScalarInt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">GPState</span><span class="p">,</span> <span class="n">GPState</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits the GP model using MCMC.</span>
<span class="sd">    It perfoms n_mcmc iterations of the structure, and for each</span>
<span class="sd">    accepted structure move performs n_hmc iterations of the HMC</span>
<span class="sd">    sampler over the parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : PRNGKeyArray</span>
<span class="sd">        Random key for MCMC sampling.</span>
<span class="sd">    n_mcmc : ScalarInt</span>
<span class="sd">        Number of MCMC iterations over kernel structure.</span>
<span class="sd">    n_hmc : ScalarInt</span>
<span class="sd">        Number of HMC steps for continuous parameters. Only used if</span>
<span class="sd">        the structure move is accepted.</span>
<span class="sd">    verbosity : ScalarInt, optional</span>
<span class="sd">        The verbosity level, by default 0. Debugging information</span>
<span class="sd">        is printed if `verbosity &gt; 1`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GPState</span>
<span class="sd">        The final state of the model, wrapped in an GPState object (see</span>
<span class="sd">        gallifrey.inference.state.GPState for details).</span>
<span class="sd">    GPState</span>
<span class="sd">        The history over all MCMC iterations, wrapped in an GPState object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_mcmc</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Expected `n_mcmc` to be an integer, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">n_mcmc</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_hmc</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Expected `n_hmc` to be an integer, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">n_hmc</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">n_mcmc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Expected `n_mcmc` to be a positive integer, but got </span><span class="si">{</span><span class="n">n_mcmc</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">n_hmc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Expected `n_hmc` to be a positive integer, but got </span><span class="si">{</span><span class="n">n_hmc</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">nnx</span><span class="o">.</span><span class="n">State</span><span class="p">,</span> <span class="n">ScalarInt</span><span class="p">,</span> <span class="n">ScalarInt</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper around the rejuvenate_particle function using</span>
<span class="sd">        GPmodel attributes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rejuvenate_particle</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">state</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noise_prior</span><span class="p">,</span>
            <span class="n">n_mcmc</span><span class="o">=</span><span class="n">n_mcmc</span><span class="p">,</span>
            <span class="n">n_hmc</span><span class="o">=</span><span class="n">n_hmc</span><span class="p">,</span>
            <span class="n">fix_noise</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span><span class="p">,</span>
            <span class="n">hmc_sampler_factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmc_sampler_factory</span><span class="p">,</span>
            <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">final_state</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">accepted_mcmc</span><span class="p">,</span> <span class="n">accepted_hmc</span> <span class="o">=</span> <span class="n">pmap</span><span class="p">(</span>
        <span class="n">jit</span><span class="p">(</span><span class="n">wrapper</span><span class="p">),</span> <span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)(</span>
        <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">)),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">particle_states</span><span class="p">,</span>  <span class="c1"># use states batched over 0th axis</span>
    <span class="p">)</span>

    <span class="c1"># print information</span>
    <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">acc_mcmc</span><span class="p">,</span> <span class="n">acc_hmc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">),</span> <span class="n">accepted_mcmc</span><span class="p">,</span> <span class="n">accepted_hmc</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Particle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> | Accepted: MCMC[</span><span class="si">{</span><span class="n">acc_mcmc</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_mcmc</span><span class="si">}</span><span class="s2">] &quot;</span>
                <span class="sa">f</span><span class="s2">&quot; HMC[</span><span class="si">{</span><span class="n">acc_hmc</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">acc_mcmc</span><span class="o">*</span><span class="n">n_hmc</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="p">)</span>

    <span class="c1"># wrap final state and history in GPState objects, for consistency</span>
    <span class="c1"># with the SMC algorithm</span>
    <span class="n">final_state_wrapped</span> <span class="o">=</span> <span class="n">GPState</span><span class="p">(</span>
        <span class="n">particle_states</span><span class="o">=</span><span class="n">final_state</span><span class="p">,</span>
        <span class="n">num_particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">,</span>
        <span class="n">num_data_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
        <span class="n">mcmc_accepted</span><span class="o">=</span><span class="n">accepted_mcmc</span><span class="p">,</span>
        <span class="n">hmc_accepted</span><span class="o">=</span><span class="n">accepted_hmc</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">history_wrapped</span> <span class="o">=</span> <span class="n">GPState</span><span class="p">(</span>
        <span class="n">particle_states</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
        <span class="n">num_particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">,</span>
        <span class="n">num_data_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
        <span class="n">mcmc_accepted</span><span class="o">=</span><span class="n">accepted_mcmc</span><span class="p">,</span>
        <span class="n">hmc_accepted</span><span class="o">=</span><span class="n">accepted_hmc</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">final_state_wrapped</span><span class="p">,</span> <span class="n">history_wrapped</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.fit_smc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit_smc</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">annealing_schedule</span><span class="p">,</span> <span class="n">n_mcmc</span><span class="p">,</span> <span class="n">n_hmc</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fits the GP model using SMC.</p>
<p>For a detailed description of the SMC algorithm, see the
'gallofrey.inference.smc.smc_loop' function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="jaxtyping.PRNGKeyArray">PRNGKeyArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The random key for the SMC sampling.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annealing_schedule</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, ...]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data annealing schedule for the SMC algorithm,
number of data points to consider at each step.
NOTE: Must be given in form of a tuple of integers, for
jax compatibility. Easily generated using the <code>generate</code>
method of the <code>Schedule</code> in <code>gallifrey.schedule</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_mcmc</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of MCMC iterations over kernel structure per
SMC step.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_hmc</code>
            </td>
            <td>
                  <code><span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of HMC steps for continuous parameters per
SMC step. Only used if the structure move is accepted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbosity</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The verbosity level, by default 0. Debugging information
is printed if <code>verbosity &gt; 1</code>.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The final SMC state. Contains the final particle states
and the final weights (among other things, see
'gallifrey.inference.state.GPState' for details).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The history of the SMC algorithm. Contains the particle
states and weights at each step of the algorithm.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit_smc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">PRNGKeyArray</span><span class="p">,</span>
    <span class="n">annealing_schedule</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">n_mcmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">n_hmc</span><span class="p">:</span> <span class="n">ScalarInt</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">GPState</span><span class="p">,</span> <span class="n">GPState</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits the GP model using SMC.</span>

<span class="sd">    For a detailed description of the SMC algorithm, see the</span>
<span class="sd">    &#39;gallofrey.inference.smc.smc_loop&#39; function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : PRNGKeyArray</span>
<span class="sd">        The random key for the SMC sampling.</span>
<span class="sd">    annealing_schedule : tuple[int, ...]</span>
<span class="sd">        The data annealing schedule for the SMC algorithm,</span>
<span class="sd">        number of data points to consider at each step.</span>
<span class="sd">        NOTE: Must be given in form of a tuple of integers, for</span>
<span class="sd">        jax compatibility. Easily generated using the `generate`</span>
<span class="sd">        method of the `Schedule` in `gallifrey.schedule`.</span>
<span class="sd">    n_mcmc : ScalarInt</span>
<span class="sd">        Number of MCMC iterations over kernel structure per</span>
<span class="sd">        SMC step.</span>
<span class="sd">    n_hmc : ScalarInt</span>
<span class="sd">        Number of HMC steps for continuous parameters per</span>
<span class="sd">        SMC step. Only used if the structure move is accepted.</span>
<span class="sd">    verbosity : int, optional</span>
<span class="sd">        The verbosity level, by default 0. Debugging information</span>
<span class="sd">        is printed if `verbosity &gt; 1`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GPState</span>
<span class="sd">        The final SMC state. Contains the final particle states</span>
<span class="sd">        and the final weights (among other things, see</span>
<span class="sd">        &#39;gallifrey.inference.state.GPState&#39; for details).</span>
<span class="sd">    GPState</span>
<span class="sd">        The history of the SMC algorithm. Contains the particle</span>
<span class="sd">        states and weights at each step of the algorithm.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">final_smc_state</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">smc_loop</span><span class="p">(</span>
        <span class="n">key</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">particle_states</span><span class="p">,</span>
        <span class="n">annealing_schedule</span><span class="p">,</span>
        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_prior</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_prior</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_noise</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hmc_sampler_factory</span><span class="p">,</span>
        <span class="n">n_mcmc</span><span class="p">,</span>
        <span class="n">n_hmc</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">batched_history</span><span class="p">:</span> <span class="n">GPState</span> <span class="o">=</span> <span class="n">batch_states</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_smc_state</span><span class="p">,</span> <span class="n">batched_history</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.get_mixture_distribution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_mixture_distribution</span><span class="p">(</span><span class="n">xpredict</span><span class="p">,</span> <span class="n">gpstate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_particles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the mixture distribution of an SMC state.</p>
<p>The predictive distributions for an SMC ensemble are
the individual predictive (Gaussion) distributions of the
particles, weighted by the particle weights. The resulting
distribution is a Gaussian mixture model, implemented as
a <code>MixtureSameFamily</code> distribution from <code>tensorflow_probability</code>, see
https://www.tensorflow.org/probability/api_docs/python/tfp/distributions/MixtureSameFamily</p>
<p>The mixture distribution is calculated at the points <code>xpredict</code>
and conditioned on the training data (which was supplied to construct
the model instance).</p>
<p>The input should be an GPState object as returned by the <code>fit_smc</code> method.
Alternatively, the log weights can be provided explicitly using the
<code>log_weights</code> argument.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xpredict</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="gallifrey.utils.typing.Array">Array</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The points to predict, as a 1D array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gpstate</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GP state object, containing the particle states and log weights for
the mixture distribution. If None, the current state of the model is used.
By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="Dataset (gallifrey.data.Dataset)" href="data/#gallifrey.data.Dataset">Dataset</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data to condition the predictive distribution on. If None,
the training data of the model is used. By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_weights</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="gallifrey.utils.typing.Array">Array</span>, &#39; N&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The log weights of the particles. If None, the log weights from the
GP state are used. An error is raised if the log weights are not provided
and the GP state does not contain log weights. By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_particles</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="gallifrey.utils.typing.ScalarInt">ScalarInt</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of particles to include in the mixture distribution. If None,
all particles in the state are included. If provided, a random sample
of particles is chosen based on the weights. By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<span title="jaxtyping.PRNGKeyArray">PRNGKeyArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random key for sampling the particles. Required if <code>num_particles</code> is
provided. By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>latent</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the predictive distribution of the latent
functions only (without observational noise), by default
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tensorflow_probability.substrates.jax.distributions.Distribution">Distribution</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tensorflow probability distribution object representing
the Gaussian mixture distribution of the Gaussian processes
(a MixtureSameFamily distribution).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the GPState object contains no log weights and <code>log_weights</code> is None.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the number of particles and log weights are inconsistent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_mixture_distribution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">xpredict</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
    <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log_weights</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; N&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_particles</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ScalarInt</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">PRNGKeyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">latent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Distribution</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the mixture distribution of an SMC state.</span>

<span class="sd">    The predictive distributions for an SMC ensemble are</span>
<span class="sd">    the individual predictive (Gaussion) distributions of the</span>
<span class="sd">    particles, weighted by the particle weights. The resulting</span>
<span class="sd">    distribution is a Gaussian mixture model, implemented as</span>
<span class="sd">    a `MixtureSameFamily` distribution from `tensorflow_probability`, see</span>
<span class="sd">    https://www.tensorflow.org/probability/api_docs/python/tfp/distributions/MixtureSameFamily</span>

<span class="sd">    The mixture distribution is calculated at the points `xpredict`</span>
<span class="sd">    and conditioned on the training data (which was supplied to construct</span>
<span class="sd">    the model instance).</span>

<span class="sd">    The input should be an GPState object as returned by the `fit_smc` method.</span>
<span class="sd">    Alternatively, the log weights can be provided explicitly using the</span>
<span class="sd">    `log_weights` argument.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xpredict : Float[Array, &quot; D&quot;]</span>
<span class="sd">        The points to predict, as a 1D array.</span>
<span class="sd">    gpstate : tp.Optional[GPState], optional</span>
<span class="sd">        The GP state object, containing the particle states and log weights for</span>
<span class="sd">        the mixture distribution. If None, the current state of the model is used.</span>
<span class="sd">        By default None.</span>
<span class="sd">    data : tp.Optional[Dataset], optional</span>
<span class="sd">        The data to condition the predictive distribution on. If None,</span>
<span class="sd">        the training data of the model is used. By default None.</span>
<span class="sd">    log_weights : Float[Array, &quot; N&quot;], optional</span>
<span class="sd">        The log weights of the particles. If None, the log weights from the</span>
<span class="sd">        GP state are used. An error is raised if the log weights are not provided</span>
<span class="sd">        and the GP state does not contain log weights. By default None.</span>
<span class="sd">    num_particles : tp.Optional[ScalarInt], optional</span>
<span class="sd">        Number of particles to include in the mixture distribution. If None,</span>
<span class="sd">        all particles in the state are included. If provided, a random sample</span>
<span class="sd">        of particles is chosen based on the weights. By default None.</span>
<span class="sd">    key : tp.Optional[PRNGKeyArray], optional</span>
<span class="sd">        Random key for sampling the particles. Required if `num_particles` is</span>
<span class="sd">        provided. By default None.</span>
<span class="sd">    latent : bool, optional</span>
<span class="sd">        Whether to return the predictive distribution of the latent</span>
<span class="sd">        functions only (without observational noise), by default</span>
<span class="sd">        False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Distribution</span>
<span class="sd">        A tensorflow probability distribution object representing</span>
<span class="sd">        the Gaussian mixture distribution of the Gaussian processes</span>
<span class="sd">        (a MixtureSameFamily distribution).</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the GPState object contains no log weights and `log_weights` is None.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the number of particles and log weights are inconsistent.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gpstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">gpstate</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">gpstate</span><span class="o">.</span><span class="n">log_weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">log_weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The GPState object contains no log weights. This might be &quot;</span>
            <span class="s2">&quot;because the state was produced with the MCMC sampler or the &quot;</span>
            <span class="s2">&quot;initial state of the GPModel was used. Please either run &quot;</span>
            <span class="s2">&quot;`fit_smc` or provide the log weights explicitly. (Note: If &quot;</span>
            <span class="s2">&quot;you already ran `fit_smc` and this error occurs, make sure to &quot;</span>
            <span class="s2">&quot;passed the the output of `fit_smc` to this method, or run the &quot;</span>
            <span class="s2">&quot;`update_state` method with the output of `fit_smc` as input.)&quot;</span>
        <span class="p">)</span>

    <span class="n">log_weights</span> <span class="o">=</span> <span class="n">log_weights</span> <span class="k">if</span> <span class="n">log_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">gpstate</span><span class="o">.</span><span class="n">log_weights</span>

    <span class="k">assert</span> <span class="n">log_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_weights</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Inconsistent number of particles and log weights, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="si">}</span><span class="s2"> but got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">log_weights</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="n">individual_distributions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predictive_distributions</span><span class="p">(</span>
        <span class="n">xpredict</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">gpstate</span><span class="p">,</span>
        <span class="n">latent</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">num_particles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If `num_particles` is provided, `key` must also be provided. &quot;</span>
                <span class="s2">&quot;This is the random key for sampling from the particles.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">num_particles</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Number of particles to sample (</span><span class="si">{</span><span class="n">num_particles</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;exceeds the total number of particles (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>
        <span class="c1"># choose random sample of particles based on weights</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_weights</span><span class="p">)</span>
        <span class="n">particle_indices</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)),</span>
            <span class="n">p</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_particles</span><span class="p">),),</span>
            <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># normalize weights</span>
        <span class="n">log_weights</span> <span class="o">=</span> <span class="n">log_weights</span><span class="p">[</span><span class="n">particle_indices</span><span class="p">]</span> <span class="o">-</span> <span class="n">logsumexp</span><span class="p">(</span>
            <span class="n">log_weights</span><span class="p">[</span><span class="n">particle_indices</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># select particles</span>
        <span class="n">individual_distributions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">individual_distributions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">particle_indices</span>
        <span class="p">]</span>

    <span class="n">batched_distributions</span> <span class="o">=</span> <span class="n">batch_states</span><span class="p">(</span><span class="n">individual_distributions</span><span class="p">)</span>

    <span class="n">mixture_model</span> <span class="o">=</span> <span class="n">MixtureSameFamily</span><span class="p">(</span>
        <span class="n">mixture_distribution</span><span class="o">=</span><span class="n">Categorical</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">log_weights</span><span class="p">),</span>
        <span class="n">components_distribution</span><span class="o">=</span><span class="n">batched_distributions</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">mixture_model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.get_particles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_particles</span><span class="p">(</span><span class="n">gpstate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a list of Particle instances from a GP state.</p>
<p>If no state is provided, the current state of the model
is used.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gpstate</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GP state to extract the particles from. If None,
the current state of the model is used. By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Particle (gallifrey.particles.Particle)" href="particles/#gallifrey.particles.Particle">Particle</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of Particle instances, corresponding to the
individual states.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_particles</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Particle</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of Particle instances from a GP state.</span>

<span class="sd">    If no state is provided, the current state of the model</span>
<span class="sd">    is used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gpstate : tp.Optional[GPState], optional</span>
<span class="sd">        The GP state to extract the particles from. If None,</span>
<span class="sd">        the current state of the model is used. By default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[Particle]</span>
<span class="sd">        A list of Particle instances, corresponding to the</span>
<span class="sd">        individual states.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gpstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>

    <span class="n">unbatched_particle_states</span> <span class="o">=</span> <span class="n">unbatch_states</span><span class="p">(</span><span class="n">gpstate</span><span class="o">.</span><span class="n">particle_states</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">nnx</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particle_graphdef</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">unbatched_particle_states</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.get_predictive_distributions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_predictive_distributions</span><span class="p">(</span><span class="n">xpredict</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gpstate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the predictive distributions for the individual particles
in the GP state. The distributions are calculated at the points
<code>x_predict</code> and conditioned on the training data (which was supplied
to construct the model instance).</p>
<p>The distributions are returned as a list of tensorflow probability
distribution objects, see
https://www.tensorflow.org/probability/api_docs/python/tfp/distributions/MultivariateNormalFullCovariance</p>
<p>If no state is provided, the current state of the model
is used.</p>
<p>If <code>latent</code> is True, the predictive distribution is that of the latent
function, i.e. the distribution of the function values without the
observational noise. If False, the predictive distribution of the full
data-generating model is returned, which includes the observational noise.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xpredict</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Float">Float</span>[<span title="gallifrey.utils.typing.Array">Array</span>, &#39; D&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The points to predict, as a 1D array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="Dataset (gallifrey.data.Dataset)" href="data/#gallifrey.data.Dataset">Dataset</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data to condition the predictive distribution on. If None,
the training data of the model is used. By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gpstate</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GP state object, containing the particle states. If None,
the current state of the model is used. By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>latent</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the predictive distribution of the latent
functions only (without observational noise), by default
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="tensorflow_probability.substrates.jax.distributions.Distribution">Distribution</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of tensorflow probability distribution objects
representing the predictive distributions of the Gaussian
processes. (Specifically, a MultivariateNormalFullCovariance
distribution from <code>tensorflow_probability.substrates.jax.distributions</code>).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_predictive_distributions</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">xpredict</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot; D&quot;</span><span class="p">],</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">latent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Distribution</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the predictive distributions for the individual particles</span>
<span class="sd">    in the GP state. The distributions are calculated at the points</span>
<span class="sd">    `x_predict` and conditioned on the training data (which was supplied</span>
<span class="sd">    to construct the model instance).</span>

<span class="sd">    The distributions are returned as a list of tensorflow probability</span>
<span class="sd">    distribution objects, see</span>
<span class="sd">    https://www.tensorflow.org/probability/api_docs/python/tfp/distributions/MultivariateNormalFullCovariance</span>

<span class="sd">    If no state is provided, the current state of the model</span>
<span class="sd">    is used.</span>

<span class="sd">    If `latent` is True, the predictive distribution is that of the latent</span>
<span class="sd">    function, i.e. the distribution of the function values without the</span>
<span class="sd">    observational noise. If False, the predictive distribution of the full</span>
<span class="sd">    data-generating model is returned, which includes the observational noise.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xpredict : Float[Array, &quot; D&quot;]</span>
<span class="sd">        The points to predict, as a 1D array.</span>
<span class="sd">    data : tp.Optional[Dataset], optional</span>
<span class="sd">        The data to condition the predictive distribution on. If None,</span>
<span class="sd">        the training data of the model is used. By default None.</span>
<span class="sd">    gpstate : tp.Optional[GPState], optional</span>
<span class="sd">        The GP state object, containing the particle states. If None,</span>
<span class="sd">        the current state of the model is used. By default None.</span>
<span class="sd">    latent : bool, optional</span>
<span class="sd">        Whether to return the predictive distribution of the latent</span>
<span class="sd">        functions only (without observational noise), by default</span>
<span class="sd">        False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[Distribution]</span>
<span class="sd">        A list of tensorflow probability distribution objects</span>
<span class="sd">        representing the predictive distributions of the Gaussian</span>
<span class="sd">        processes. (Specifically, a MultivariateNormalFullCovariance</span>
<span class="sd">        distribution from `tensorflow_probability.substrates.jax.distributions`).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gpstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">gpstate</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span>

    <span class="n">particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_particles</span><span class="p">(</span><span class="n">gpstate</span><span class="p">)</span>
    <span class="n">distributions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">particle</span><span class="o">.</span><span class="n">predictive_distribution</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">xpredict</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">latent</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="n">particles</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">distributions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.load_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_state</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Load a GP state from file.</p>
<p>Note that only the state is loaded. It is assumed that the model
configuration is consistent with how the state was saved. If the
model configuration is different, the loaded state might not be
consistent with the model.</p>
<p>The model does not get update with the loaded state. To update the
model, use the <code>update_gpstate</code> method with the loaded state.</p>
<p>TODO: Implement loading the model configuration as well.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.PosixPath">PosixPath</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path where to load the GP state from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the GPState object, containing the loaded state.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_state</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PosixPath</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GPState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a GP state from file.</span>

<span class="sd">    Note that only the state is loaded. It is assumed that the model</span>
<span class="sd">    configuration is consistent with how the state was saved. If the</span>
<span class="sd">    model configuration is different, the loaded state might not be</span>
<span class="sd">    consistent with the model.</span>

<span class="sd">    The model does not get update with the loaded state. To update the</span>
<span class="sd">    model, use the `update_gpstate` method with the loaded state.</span>

<span class="sd">    TODO: Implement loading the model configuration as well.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str | PosixPath</span>
<span class="sd">        The path where to load the GP state from.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GPState</span>
<span class="sd">        An instance of the GPState object, containing the loaded state.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">gpstate</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gpstate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.save_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_state</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">gpstate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Save a GP state to file.</p>
<p>Note that only the state is saved and not the model itself.
That means if the model is loaded with a different configuration
(e.g. different kernel library), the state might not be consistent
with the model.</p>
<p>TODO: Implement saving the model configuration as well.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.PosixPath">PosixPath</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path where to save the GP state, must
be an absolute path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gpstate</code>
            </td>
            <td>
                  <code><span title="beartype.typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GP state to save, If None, the current state
of the model is used. By default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_state</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PosixPath</span><span class="p">,</span>
    <span class="n">gpstate</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">GPState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a GP state to file.</span>

<span class="sd">    Note that only the state is saved and not the model itself.</span>
<span class="sd">    That means if the model is loaded with a different configuration</span>
<span class="sd">    (e.g. different kernel library), the state might not be consistent</span>
<span class="sd">    with the model.</span>

<span class="sd">    TODO: Implement saving the model configuration as well.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str | PosixPath</span>
<span class="sd">        The path where to save the GP state, must</span>
<span class="sd">        be an absolute path.</span>
<span class="sd">    gpstate : tp.Optional[GPState], optional</span>
<span class="sd">        The GP state to save, If None, the current state</span>
<span class="sd">        of the model is used. By default None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">gpstate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gpstate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">gpstate</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gallifrey.GPModel.update_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_state</span><span class="p">(</span><span class="n">gpstate</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the GP state. Returns a new GPModel instance (no in-place
update). If the number of particles in the new state is different
from the current state, the num_particles attribute is updated.</p>
<p>Note that no other attributes are updated. If the particle states
were created using a different configuration, the model will not be
consistent.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gpstate</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPState (gallifrey.inference.state.GPState)" href="inference/state/#gallifrey.inference.state.GPState">GPState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new GP state to update the model with.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GPModel (gallifrey.model.GPModel)" href="model/#gallifrey.model.GPModel">GPModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new GPModel instance with updated state.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gpstate</span><span class="p">:</span> <span class="n">GPState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GPModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the GP state. Returns a new GPModel instance (no in-place</span>
<span class="sd">    update). If the number of particles in the new state is different</span>
<span class="sd">    from the current state, the num_particles attribute is updated.</span>

<span class="sd">    Note that no other attributes are updated. If the particle states</span>
<span class="sd">    were created using a different configuration, the model will not be</span>
<span class="sd">    consistent.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gpstate : GPState</span>
<span class="sd">        The new GP state to update the model with.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GPModel</span>
<span class="sd">        A new GPModel instance with updated state.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">new_gpmodel</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">new_gpmodel</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">gpstate</span>

    <span class="k">return</span> <span class="n">new_gpmodel</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="gallifrey.LinearSchedule" class="doc doc-heading">
            <code>LinearSchedule</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Schedule (gallifrey.schedule.Schedule)" href="schedule/#gallifrey.schedule.Schedule">Schedule</a></code></p>


        <p>Linear scheduler, adds roughly
<code>n * percent</code> new observations at each step.</p>







              <details class="quote">
                <summary>Source code in <code>gallifrey/schedule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LinearSchedule</span><span class="p">(</span><span class="n">Schedule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Linear scheduler, adds roughly</span>
<span class="sd">    `n * percent` new observations at each step.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span>
        <span class="n">num_datapoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a linear annealing schedule.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_datapoints : int</span>
<span class="sd">            The total number of datapoints.</span>
<span class="sd">        num_steps : int</span>
<span class="sd">            The number of steps in the schedule.</span>
<span class="sd">        start : int, optional</span>
<span class="sd">            The starting point of the schedule,</span>
<span class="sd">            by default 1 (one observation).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[int, ...]</span>
<span class="sd">            A tuple of integers representing the cumulative number of</span>
<span class="sd">            observations at each step of the schedule. Length of the</span>
<span class="sd">            tuple is `num_steps`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if only one step, run total number of datapoints</span>
        <span class="k">if</span> <span class="n">num_steps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">num_datapoints</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                    <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                    <span class="n">stop</span><span class="o">=</span><span class="n">num_datapoints</span><span class="p">,</span>
                    <span class="n">num</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="gallifrey.LinearSchedule.generate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate</span><span class="p">(</span><span class="n">num_datapoints</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a linear annealing schedule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_datapoints</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total number of datapoints.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of steps in the schedule.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The starting point of the schedule,
by default 1 (one observation).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, ...]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple of integers representing the cumulative number of
observations at each step of the schedule. Length of the
tuple is <code>num_steps</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/schedule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span>
    <span class="n">num_datapoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">num_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a linear annealing schedule.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num_datapoints : int</span>
<span class="sd">        The total number of datapoints.</span>
<span class="sd">    num_steps : int</span>
<span class="sd">        The number of steps in the schedule.</span>
<span class="sd">    start : int, optional</span>
<span class="sd">        The starting point of the schedule,</span>
<span class="sd">        by default 1 (one observation).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[int, ...]</span>
<span class="sd">        A tuple of integers representing the cumulative number of</span>
<span class="sd">        observations at each step of the schedule. Length of the</span>
<span class="sd">        tuple is `num_steps`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if only one step, run total number of datapoints</span>
    <span class="k">if</span> <span class="n">num_steps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">num_datapoints</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                <span class="n">stop</span><span class="o">=</span><span class="n">num_datapoints</span><span class="p">,</span>
                <span class="n">num</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="gallifrey.LogSchedule" class="doc doc-heading">
            <code>LogSchedule</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Schedule (gallifrey.schedule.Schedule)" href="schedule/#gallifrey.schedule.Schedule">Schedule</a></code></p>


        <p>A logarithmic scheduler, adds observations in a logarithmic fashion.</p>







              <details class="quote">
                <summary>Source code in <code>gallifrey/schedule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LogSchedule</span><span class="p">(</span><span class="n">Schedule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A logarithmic scheduler, adds observations in a logarithmic fashion.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span>
        <span class="n">num_datapoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a logarithmic annealing schedule.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_datapoints : int</span>
<span class="sd">            The total number of datapoints.</span>
<span class="sd">        num_steps : int</span>
<span class="sd">            The number of steps in the schedule.</span>
<span class="sd">        start : int, optional</span>
<span class="sd">            The starting point of the schedule,</span>
<span class="sd">            by default 1 (one observation).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[int, ...]</span>
<span class="sd">            A tuple of integers representing the cumulative number of</span>
<span class="sd">            observations at each step of the schedule. Length of the</span>
<span class="sd">            tuple is `num_steps`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if only one step, run total number of datapoints</span>
        <span class="k">if</span> <span class="n">num_steps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">num_datapoints</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span>
                    <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                    <span class="n">stop</span><span class="o">=</span><span class="n">num_datapoints</span><span class="p">,</span>
                    <span class="n">num</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="gallifrey.LogSchedule.generate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate</span><span class="p">(</span><span class="n">num_datapoints</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a logarithmic annealing schedule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_datapoints</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total number of datapoints.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of steps in the schedule.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The starting point of the schedule,
by default 1 (one observation).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, ...]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple of integers representing the cumulative number of
observations at each step of the schedule. Length of the
tuple is <code>num_steps</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>gallifrey/schedule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span>
    <span class="n">num_datapoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">num_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a logarithmic annealing schedule.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num_datapoints : int</span>
<span class="sd">        The total number of datapoints.</span>
<span class="sd">    num_steps : int</span>
<span class="sd">        The number of steps in the schedule.</span>
<span class="sd">    start : int, optional</span>
<span class="sd">        The starting point of the schedule,</span>
<span class="sd">        by default 1 (one observation).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[int, ...]</span>
<span class="sd">        A tuple of integers representing the cumulative number of</span>
<span class="sd">        observations at each step of the schedule. Length of the</span>
<span class="sd">        tuple is `num_steps`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if only one step, run total number of datapoints</span>
    <span class="k">if</span> <span class="n">num_steps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">num_datapoints</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span>
                <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                <span class="n">stop</span><span class="o">=</span><span class="n">num_datapoints</span><span class="p">,</span>
                <span class="n">num</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy", "content.code.annotate", "header.autohide"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>